var Le=Object.defineProperty,ct=Object.defineProperties;var dt=Object.getOwnPropertyDescriptors;var Fe=Object.getOwnPropertySymbols;var mt=Object.prototype.hasOwnProperty,pt=Object.prototype.propertyIsEnumerable;var Ae=(n,e,t)=>e in n?Le(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,f=(n,e)=>{for(var t in e||(e={}))mt.call(e,t)&&Ae(n,t,e[t]);if(Fe)for(var t of Fe(e))pt.call(e,t)&&Ae(n,t,e[t]);return n},v=(n,e)=>ct(n,dt(e));var V=(n,e)=>{for(var t in e)Le(n,t,{get:e[t],enumerable:!0})};var i=(n,e,t)=>(Ae(n,typeof e!="symbol"?e+"":e,t),t);var U=class{constructor(e){this.options=e;i(this,"authorization");i(this,"exchangeManager");i(this,"swapManager");i(this,"signers");i(this,"atomexContext");if(this.atomexContext=e.atomexContext,this.signers=e.managers.signersManager,this.authorization=e.managers.authorizationManager,this.exchangeManager=e.managers.exchangeManager,this.swapManager=e.managers.swapManager,e.blockchains)for(let t of Object.keys(e.blockchains))this.addBlockchain(r=>e.blockchains[t])}get atomexNetwork(){return this.atomexContext.atomexNetwork}async addSigner(e){var t,r;await this.signers.addSigner(e),await((r=(t=this.options.blockchains)==null?void 0:t[e.blockchain])==null?void 0:r.mainnet.blockchainToolkitProvider.addSigner(e))}addBlockchain(e){}async swap(e,t){throw new Error("Not implemented")}dispose(){this.authorization.dispose()}};var Ce=class{constructor(e){this.atomexNetwork=e;i(this,"id");i(this,"managers");i(this,"services");this.id=Ce.idCounter++,this.managers=new Te(this),this.services=new ve(this)}},W=Ce;i(W,"idCounter",0);var Te=class{constructor(e){this.context=e;i(this,"_signersManager");i(this,"_authorizationManager");i(this,"_exchangeManager");i(this,"_swapManager")}get signersManager(){if(!this._signersManager)throw new x("managers.signersManager");return this._signersManager}set signersManager(e){this._signersManager=e}get authorizationManager(){if(!this._authorizationManager)throw new x("managers.authorizationManager");return this._authorizationManager}set authorizationManager(e){this._authorizationManager=e}get exchangeManager(){if(!this._exchangeManager)throw new x("managers.exchangeManager");return this._exchangeManager}set exchangeManager(e){this._exchangeManager=e}get swapManager(){if(!this._swapManager)throw new x("managers.swapManager");return this._swapManager}set swapManager(e){this._swapManager=e}},ve=class{constructor(e){this.context=e;i(this,"_exchangeService");i(this,"_swapService")}get exchangeService(){if(!this._exchangeService)throw new x("services.exchangeService");return this._exchangeService}set exchangeService(e){this._exchangeService=e}get swapService(){if(!this._swapService)throw new x("services.swapService");return this._swapService}set swapService(e){this._swapService=e}},x=class extends Error{constructor(t){super(x.getMessage(t));i(this,"name");i(this,"componentName");this.componentName=t,this.name=this.constructor.name}static getMessage(t){return`Atomex "${t}" component has not resolved yet`}};var P={};V(P,{hexStringToObject:()=>lt,hexStringToString:()=>He,hexStringToUint8Array:()=>Ke,numberToTokensAmount:()=>gt,objectToHexString:()=>ut,stringToHexString:()=>Qe,tokensAmountToNat:()=>ht,uint8ArrayToHexString:()=>he});import $e from"bignumber.js";import{Buffer as C}from"buffer";var Ke=n=>{var t;let e=(t=n.match(/[\da-f]{2}/gi))==null?void 0:t.map(r=>parseInt(r,16));return new Uint8Array(e)},he=n=>C.from(n).toString("hex"),Qe=n=>C.from(n,"utf8").toString("hex"),He=n=>C.from(Ke(n)).toString("utf8"),ut=n=>Qe(JSON.stringify(n)),lt=n=>{try{return JSON.parse(He(n))}catch(e){return null}},ht=(n,e)=>new $e(n).multipliedBy(10**e).integerValue(),gt=(n,e)=>new $e(n).integerValue().div(10**e);var k={};V(k,{ensureNetworksAreSame:()=>yt});var yt=(n,e)=>{if((typeof n=="string"?n:n.atomexNetwork)!==(typeof e=="string"?e:e.atomexNetwork))throw new Error("Networks are different")};var J={};V(J,{capitalize:()=>ft,padEnd:()=>xt,padStart:()=>St});var ft=n=>{var e;return n&&((e=n[0])==null?void 0:e.toLocaleUpperCase())+n.slice(1)},je=(n,e,t,r=" ")=>{if(String.prototype.padStart!==void 0)return n.padStart(t,r);let o=n.length;if(t<=o||r=="")return n;let a=t-o,s=r.repeat(Math.ceil(a/r.length));return s.length>a&&(s=s.slice(0,a)),e?s+n:n+s},St=(n,e,t=" ")=>String.prototype.padStart!==void 0?n.padStart(e,t):je(n,!0,e,t),xt=(n,e,t=" ")=>String.prototype.padEnd!==void 0?n.padEnd(e,t):je(n,!1,e,t);var ar=n=>new Promise(e=>setTimeout(e,n)),Pe=n=>Math.min(n,2147483647);var q=class{constructor(e){this.atomexNetwork=e;i(this,"_signers",new Set)}get signers(){return this._signers}addSigner(e){return k.ensureNetworksAreSame(this,e),this._signers.add(e),Promise.resolve(e)}async removeSigner(e,t){let r=typeof e=="string"?await this.findSigner(e,t):e;return r?this._signers.delete(r):!1}async findSigner(e,t){if(!this.signers.size)return;let r=[];for(let a of this.signers){if(t&&a.blockchain!==t)continue;let s=a.getAddress();if(typeof s=="string"){if(s===e)return a;continue}r.push(s.then(c=>[a,c]))}let o=await Promise.allSettled(r);for(let a of o)if(a.status==="fulfilled"&&a.value[1]===e)return a.value[0]}};var Z=(r=>(r[r.Local=0]="Local",r[r.Remote=1]="Remote",r[r.SafeMerged=2]="SafeMerged",r))(Z||{});var ge=class{constructor(e){i(this,"currencies");this.currencies=new Map(e instanceof Map?e:Object.entries(e))}getCurrency(e){return Promise.resolve(this.currencies.get(e))}addCurrency(e){this.currencies.set(e.id,e)}removeCurrency(e){return this.currencies.delete(e)}};var p=class{constructor(){i(this,"listeners",new Set)}addListener(e){return this.listeners.add(e),this}removeListener(e){return this.listeners.has(e)&&this.listeners.delete(e),this}removeAllListeners(){return this.listeners=new Set,this}emit(...e){!this.listeners.size||(this.listeners.size===1?this.listeners.values().next().value(...e):[...this.listeners].forEach(t=>t(...e)))}};var ye=class{constructor(e){this.exchangeService=e;i(this,"events",{orderUpdated:new p,orderBookUpdated:new p,topOfBookUpdated:new p});i(this,"handleExchangeServiceOrderUpdated",e=>{this.events.orderUpdated.emit(e)});i(this,"handleExchangeServiceOrderBookUpdated",e=>{this.events.orderBookUpdated.emit(e)});i(this,"handleExchangeServiceTopOfBookUpdated",e=>{this.events.topOfBookUpdated.emit(e)});this.attachEvents()}getOrder(e,t,r=2){return this.exchangeService.getOrder(e,t)}getOrders(e,t,r=2){return this.exchangeService.getOrders(e,t)}getSymbols(){return this.exchangeService.getSymbols()}getTopOfBook(e){return this.exchangeService.getTopOfBook(e)}async getOrderBook(e){return this.exchangeService.getOrderBook(e)}addOrder(e,t){return this.exchangeService.addOrder(e,t)}cancelOrder(e,t){return this.exchangeService.cancelOrder(e,t)}cancelAllOrders(e,t){return this.exchangeService.cancelAllOrders(e,t)}getRewardForRedeem(e,t){throw new Error("Not implemented")}attachEvents(){this.exchangeService.events.orderUpdated.addListener(this.handleExchangeServiceOrderUpdated),this.exchangeService.events.orderBookUpdated.addListener(this.handleExchangeServiceOrderBookUpdated),this.exchangeService.events.topOfBookUpdated.addListener(this.handleExchangeServiceTopOfBookUpdated)}detachEvents(){this.exchangeService.events.orderUpdated.removeListener(this.handleExchangeServiceOrderUpdated),this.exchangeService.events.orderBookUpdated.removeListener(this.handleExchangeServiceOrderBookUpdated),this.exchangeService.events.topOfBookUpdated.removeListener(this.handleExchangeServiceTopOfBookUpdated)}};var fe=class{constructor(e){this.swapService=e;i(this,"events",{swapUpdated:new p});i(this,"handleSwapServiceSwapUpdated",e=>{this.events.swapUpdated.emit(e)});this.attachEvents()}getSwap(e,t,r=2){return this.swapService.getSwap(e,t)}getSwaps(e,t,r=2){return this.swapService.getSwaps(e,t)}attachEvents(){this.swapService.events.swapUpdated.addListener(this.handleSwapServiceSwapUpdated)}detachEvents(){this.swapService.events.swapUpdated.removeListener(this.handleSwapServiceSwapUpdated)}};var X=class{constructor(e){this.baseUrl=e}async request(e){let t=new URL(e.urlPath,this.baseUrl);e.params&&this.setSearchParams(t,e.params);let r=await fetch(t.toString(),{headers:this.createHeaders(e),method:e.method||"GET",body:e.payload?JSON.stringify(e.payload):void 0});if(!r.ok){let o=await r.text();throw Error(o)}return await r.json()}setSearchParams(e,t){for(let r in t){let o=t[r];o!=null&&e.searchParams.set(r,String(o))}}createHeaders(e){let t={};return e.authToken&&(t.Authorization=`Bearer ${e.authToken}`),e.method==="POST"&&e.payload&&(t["Content-Type"]="application/json"),t}};import h from"bignumber.js";var Y=n=>{let[e="",t=""]=n.split("/");return[e,t]},Ee=(n,e,t,r)=>{let[o,a]=Y(n),s=new h(e),c=new h(t),m=c.multipliedBy(s),l=s.div(m),u={currencyId:o,amount:s,price:c},g={currencyId:a,amount:m,price:l};return r==="Buy"?[g,u]:[u,g]},F=(n,e,t)=>{let r=n.find(a=>a.name===`${e}/${t}`),o="Sell";if(r||(r=n.find(a=>a.name===`${t}/${e}`),o="Buy"),!r)throw new Error(`Invalid pair: ${e}/${t}`);return[r.name,o]},Je=n=>n.map(t=>Me(t)),Me=n=>{let[e,t]=Y(n.symbol);return{ask:new h(n.ask),bid:new h(n.bid),symbol:n.symbol,timeStamp:new Date(n.timeStamp),quoteCurrency:e,baseCurrency:t}},Ze=n=>n.map(t=>{let[r,o]=Y(t.name);return{name:t.name,minimumQty:new h(t.minimumQty),quoteCurrency:r,baseCurrency:o}}),Xe=n=>{let[e,t]=Y(n.symbol);return{updateId:n.updateId,symbol:n.symbol,quoteCurrency:e,baseCurrency:t,entries:n.entries.map(o=>({side:o.side,price:new h(o.price),qtyProfile:o.qtyProfile}))}},Ye=n=>{let e=n[0];if(!e)throw new Error("Unexpected dto");let[t,r]=Y(e.symbol);return{updateId:e.updateId,symbol:e.symbol,quoteCurrency:t,baseCurrency:r,entries:n.map(a=>({side:a.side,price:new h(a.price),qtyProfile:a.qtyProfile}))}},ze=n=>{var r;let[e,t]=Ee(n.symbol,n.qty,n.price,n.side);return{id:n.id,from:e,to:t,clientOrderId:n.clientOrderId,side:n.side,symbol:n.symbol,leaveQty:new h(n.leaveQty),timeStamp:new Date(n.timeStamp),type:n.type,status:n.status,swapIds:((r=n.swaps)==null?void 0:r.map(o=>o.id))||[]}},et=n=>n.map(t=>ze(t)),Ge=n=>n.map(t=>({id:t.txId,blockId:t.blockHeight,confirmations:t.confirmations,currencyId:t.currency,status:t.status,type:t.type})),ee=n=>{let[e,t]=Ee(n.symbol,n.qty,n.price,n.side);return{isInitiator:n.isInitiator,secret:n.secret,secretHash:n.secretHash,id:Number(n.id),from:e,to:t,trade:{qty:new h(n.qty),price:new h(n.price),side:n.side,symbol:n.symbol},timeStamp:new Date(n.timeStamp),counterParty:{status:n.counterParty.status,transactions:Ge(n.counterParty.transactions),requisites:v(f({},n.counterParty.requisites),{rewardForRedeem:new h(n.counterParty.requisites.rewardForRedeem)}),trades:Ve(n.counterParty.trades)},user:{status:n.user.status,transactions:Ge(n.user.transactions),requisites:v(f({},n.user.requisites),{rewardForRedeem:new h(n.user.requisites.rewardForRedeem)}),trades:Ve(n.user.trades)}}},Ve=n=>n.map(t=>({orderId:t.orderId,price:new h(t.price),qty:new h(t.qty)})),tt=n=>n.map(t=>ee(t)),rt=n=>{let[e,t]=Ee(n.symbol,n.qty,n.price,n.side);return{id:n.id,clientOrderId:n.clientOrderId,side:n.side,status:n.status,leaveQty:new h(n.leaveQty),swapIds:n.swaps,symbol:n.symbol,type:n.type,timeStamp:new Date(n.timeStamp),from:e,to:t}};var O=class{constructor(e){i(this,"atomexNetwork");i(this,"events",{swapUpdated:new p,orderUpdated:new p,orderBookUpdated:new p,topOfBookUpdated:new p});i(this,"authorizationManager");i(this,"apiBaseUrl");i(this,"httpClient");i(this,"_symbolsCache");this.atomexNetwork=e.atomexNetwork,this.authorizationManager=e.authorizationManager,this.apiBaseUrl=e.apiBaseUrl,this.httpClient=new X(this.apiBaseUrl)}async getOrder(e,t){let r=`/v1/Orders/${t}`,o=this.getRequiredAuthToken(e),a=await this.httpClient.request({urlPath:r,authToken:o});return ze(a)}async getOrders(e,t){let r="/v1/Orders",o=this.getRequiredAuthToken(e),a=v(f({},t),{sortAsc:void 0,sort:(t==null?void 0:t.sortAsc)!==void 0?t.sortAsc?"Asc":"Desc":void 0}),s=await this.httpClient.request({urlPath:r,authToken:o,params:a});return et(s)}async getSymbols(){let e="/v1/Symbols",t=await this.httpClient.request({urlPath:e}),r=Ze(t);return this._symbolsCache=r,r}async getTopOfBook(e){let t="/v1/MarketData/quotes",r;if(e!=null&&e.length)if(typeof e[0]=="string")r=e;else{let s=await this.getCachedSymbols();r=e.map(c=>F(s,c.from,c.to)[0])}let o={symbols:r==null?void 0:r.join(",")},a=await this.httpClient.request({urlPath:t,params:o});return Je(a)}async getOrderBook(e){let t="/v1/MarketData/book",r;if(typeof e=="string")r=e;else{let s=await this.getCachedSymbols();[r]=F(s,e.from,e.to)}let o={symbol:r},a=await this.httpClient.request({urlPath:t,params:o});return Xe(a)}async addOrder(e,t){let r="/v1/Orders",o=this.getRequiredAuthToken(e),a,s;if(t.symbol&&t.side)[a,s]=[t.symbol,t.side];else if(t.from&&t.to){let l=await this.getCachedSymbols();[a,s]=F(l,t.from,t.to)}else throw new Error("Invalid newOrderRequest argument passed");let c={symbol:a,side:s,clientOrderId:t.clientOrderId,type:t.type,proofsOfFunds:t.proofsOfFunds,requisites:t.requisites,amount:t.amount.toNumber(),price:t.price.toNumber()};return(await this.httpClient.request({urlPath:r,authToken:o,method:"POST",payload:c})).orderId}async cancelOrder(e,t){let r=`/v1/Orders/${t.orderId}`,o=this.getRequiredAuthToken(e),a,s;if(t.symbol&&t.side)[a,s]=[t.symbol,t.side];else if(t.from&&t.to){let l=await this.getCachedSymbols();[a,s]=F(l,t.from,t.to)}else throw new Error("Invalid cancelOrderRequest argument passed");let c={symbol:a,side:s};return await this.httpClient.request({urlPath:r,authToken:o,params:c,method:"DELETE"})}async cancelAllOrders(e,t){let r="/v1/Orders",o=this.getRequiredAuthToken(e),a,s;if(t.symbol&&t.side)[a,s]=[t.symbol,t.side];else if(t.from&&t.to){let m=await this.getCachedSymbols();[a,s]=F(m,t.from,t.to),t.cancelAllDirections&&(s="All")}else throw new Error("Invalid cancelAllOrdersRequest argument passed");return await this.httpClient.request({urlPath:r,authToken:o,params:{symbol:a,side:s,forAllConnections:t.forAllConnections},method:"DELETE"})}getSwapTransactions(e){throw new Error("Method not implemented.")}async getSwap(e,t){let r=`/v1/Swaps/${t}`,o=this.getRequiredAuthToken(e),a=await this.httpClient.request({urlPath:r,authToken:o});return ee(a)}async getSwaps(e,t){let r="/v1/Swaps",o=this.getRequiredAuthToken(e),a=v(f({},t),{sortAsc:void 0,sort:(t==null?void 0:t.sortAsc)!==void 0?t.sortAsc?"Asc":"Desc":void 0}),s=await this.httpClient.request({urlPath:r,params:a,authToken:o});return tt(s)}getRequiredAuthToken(e){var r;let t=(r=this.authorizationManager.getAuthToken(e))==null?void 0:r.value;if(!t)throw new Error(`Cannot find auth token for address: ${e}`);return t}async getCachedSymbols(){return this._symbolsCache||(this._symbolsCache=await this.getSymbols()),this._symbolsCache}};var B=class{constructor(e,t){this.url=e;this.authToken=t;i(this,"events",{messageReceived:new p,closed:new p});i(this,"_socket");this.onMessageReceived=this.onMessageReceived.bind(this),this.onClosed=this.onClosed.bind(this)}get socket(){if(!this._socket)throw new Error("Internal websocket is not created. Use the connect method first");return this._socket}set socket(e){this._socket=e}connect(){this._socket&&this.disconnect();let e=this.authToken?["access_token",this.authToken]:void 0;this.socket=new WebSocket(this.url,e),this.socket.addEventListener("message",this.onMessageReceived),this.socket.addEventListener("error",this.onError),this.socket.addEventListener("close",this.onClosed)}disconnect(){this.socket.removeEventListener("message",this.onMessageReceived),this.socket.removeEventListener("error",this.onError),this.socket.removeEventListener("close",this.onClosed),this.socket.close()}subscribe(e){let t={method:"subscribe",data:e,requestId:Date.now()};this.socket.send(JSON.stringify(t))}unsubscribe(e){let t={method:"unsubscribe",data:e,requestId:Date.now()};this.socket.send(JSON.stringify(t))}onMessageReceived(e){this.events.messageReceived.emit(JSON.parse(e.data))}onError(e){throw new Error(`Websocket received error: ${JSON.stringify(e)}`)}onClosed(e){this.events.closed.emit(this,e)}};var Oe=class{constructor(e,t){this.webSocketApiBaseUrl=e;this.authorizationManager=t;i(this,"events",{messageReceived:new p});i(this,"sockets",new Map);this.onAuthorized=this.onAuthorized.bind(this),this.onUnauthorized=this.onUnauthorized.bind(this),this.onSocketMessageReceived=this.onSocketMessageReceived.bind(this),this.onClosed=this.onClosed.bind(this),this.subscribeOnAuthEvents()}dispose(){this.sockets.forEach((e,t)=>{this.removeSocket(t)})}subscribeOnAuthEvents(){this.authorizationManager.events.authorized.addListener(this.onAuthorized),this.authorizationManager.events.unauthorized.addListener(this.onUnauthorized)}onAuthorized(e){this.removeSocket(e.userId);let t=new B(new URL(Oe.EXCHANGE_URL_PATH,this.webSocketApiBaseUrl),e.value);t.events.messageReceived.addListener(this.onSocketMessageReceived),t.events.closed.addListener(this.onClosed),this.sockets.set(e.userId,t),t.connect()}onUnauthorized(e){this.removeSocket(e.userId)}removeSocket(e){let t=this.sockets.get(e);t&&(t.events.messageReceived.removeListener(this.onSocketMessageReceived),t.events.closed.removeListener(this.onClosed),this.sockets.delete(e),t.disconnect())}onSocketMessageReceived(e){this.events.messageReceived.emit(e)}onClosed(e,t){setTimeout(()=>{e.connect()},1e3)}},L=Oe;i(L,"EXCHANGE_URL_PATH","/ws/exchange");var te=class{constructor(e){this.webSocketApiBaseUrl=e;i(this,"events",{messageReceived:new p});i(this,"socket");this.onSocketMessageReceived=this.onSocketMessageReceived.bind(this),this.onSocketClosed=this.onSocketClosed.bind(this),this.socket=this.createWebSocket()}dispose(){this.socket.events.messageReceived.removeListener(this.onSocketMessageReceived),this.socket.events.closed.removeListener(this.onSocketClosed),this.socket.disconnect()}createWebSocket(){let e=new B(new URL(te.MARKET_DATA_URL_PATH,this.webSocketApiBaseUrl));return e.events.messageReceived.addListener(this.onSocketMessageReceived),e.events.closed.addListener(this.onSocketClosed),e.connect(),this.subscribeOnStreams(e),e}subscribeOnStreams(e){e.subscribe(te.TOP_OF_BOOK_STREAM),e.subscribe(te.ORDER_BOOK_STREAM)}onSocketClosed(e,t){setTimeout(()=>{e.connect(),this.subscribeOnStreams(e)},1e3)}onSocketMessageReceived(e){this.events.messageReceived.emit(e)}},E=te;i(E,"MARKET_DATA_URL_PATH","/ws/marketdata"),i(E,"TOP_OF_BOOK_STREAM","topOfBook"),i(E,"ORDER_BOOK_STREAM","orderBook");var _=class{constructor(e){i(this,"atomexNetwork");i(this,"events",{swapUpdated:new p,orderUpdated:new p,orderBookUpdated:new p,topOfBookUpdated:new p});i(this,"authorizationManager");i(this,"webSocketApiBaseUrl");i(this,"marketDataWebSocketClient");i(this,"exchangeWebSocketClient");this.onSocketMessageReceived=this.onSocketMessageReceived.bind(this),this.atomexNetwork=e.atomexNetwork,this.authorizationManager=e.authorizationManager,this.webSocketApiBaseUrl=e.webSocketApiBaseUrl,this.exchangeWebSocketClient=new L(this.webSocketApiBaseUrl,this.authorizationManager),this.exchangeWebSocketClient.events.messageReceived.addListener(this.onSocketMessageReceived),this.marketDataWebSocketClient=new E(this.webSocketApiBaseUrl),this.marketDataWebSocketClient.events.messageReceived.addListener(this.onSocketMessageReceived)}getOrder(e,t){throw new Error("Method not implemented.")}getOrders(e,t){throw new Error("Method not implemented.")}getSymbols(){throw new Error("Method not implemented.")}getTopOfBook(e){throw new Error("Method not implemented.")}async getOrderBook(e){throw new Error("Method not implemented.")}addOrder(e,t){throw new Error("Method not implemented.")}cancelOrder(e,t){throw new Error("Method not implemented.")}cancelAllOrders(e,t){throw new Error("Method not implemented.")}getSwapTransactions(e){throw new Error("Method not implemented.")}getSwap(e,t){throw new Error("Method not implemented.")}getSwaps(e,t){throw new Error("Method not implemented.")}dispose(){this.exchangeWebSocketClient.dispose(),this.marketDataWebSocketClient.dispose()}onSocketMessageReceived(e){switch(e.event){case"order":this.events.orderUpdated.emit(rt(e.data));break;case"swap":this.events.swapUpdated.emit(ee(e.data));break;case"topOfBook":this.events.topOfBookUpdated.emit(Me(e.data));break;case"entries":this.events.orderBookUpdated.emit(Ye(e.data));break}}};var $=class{constructor(e,t,r){this.atomexNetwork=e;this.restAtomexClient=t;this.webSocketAtomexClient=r;i(this,"events");k.ensureNetworksAreSame(this,t),k.ensureNetworksAreSame(this,r),this.events={swapUpdated:this.webSocketAtomexClient.events.swapUpdated,orderBookUpdated:this.webSocketAtomexClient.events.orderBookUpdated,orderUpdated:this.webSocketAtomexClient.events.orderUpdated,topOfBookUpdated:this.webSocketAtomexClient.events.topOfBookUpdated}}getOrder(e,t){return this.restAtomexClient.getOrder(e,t)}getOrders(e,t){return this.restAtomexClient.getOrders(e,t)}getSymbols(){return this.restAtomexClient.getSymbols()}getTopOfBook(e){return this.restAtomexClient.getTopOfBook(e)}async getOrderBook(e){return this.restAtomexClient.getOrderBook(e)}addOrder(e,t){return this.restAtomexClient.addOrder(e,t)}cancelOrder(e,t){return this.restAtomexClient.cancelOrder(e,t)}cancelAllOrders(e,t){return this.restAtomexClient.cancelAllOrders(e,t)}getSwapTransactions(e){return this.restAtomexClient.getSwapTransactions(e)}getSwap(e,t){return this.restAtomexClient.getSwap(e,t)}getSwaps(e,t){return this.restAtomexClient.getSwaps(e,t)}};var Be=(n,e)=>new $(n.atomexNetwork,new O({atomexNetwork:n.atomexNetwork,authorizationManager:n.managers.authorizationManager,apiBaseUrl:e.apiBaseUrl}),new _({atomexNetwork:n.atomexNetwork,authorizationManager:n.managers.authorizationManager,webSocketApiBaseUrl:e.webSocketApiBaseUrl}));var re=(r=>(r[r.Local=1]="Local",r[r.Remote=2]="Remote",r[r.All=3]="All",r))(re||{});var ne=class{constructor(e){i(this,"events",{authorized:new p,unauthorized:new p,authTokenExpiring:new p,authTokenExpired:new p});i(this,"atomexNetwork");i(this,"signersManager");i(this,"store");i(this,"authorizationUrl");i(this,"expiringNotificationTimeInSeconds");i(this,"_authTokenData",new Map);i(this,"authTokenExpiringTimeoutCallback",e=>{let t=this._authTokenData.get(e.address);if(!t)return;clearTimeout(t.watcherId);let r=e.expired.getTime()-Date.now(),o=setTimeout(this.authTokenExpiredTimeoutCallback,Pe(r),e);this._authTokenData.set(e.address,v(f({},t),{watcherId:o})),this.events.authTokenExpiring.emit(e)});i(this,"authTokenExpiredTimeoutCallback",e=>{this.unregisterAuthToken(e),this.events.authTokenExpired.emit(e)});this.atomexNetwork=e.atomexNetwork,this.store=e.store,this.signersManager=e.signersManager,k.ensureNetworksAreSame(this,this.signersManager),this.authorizationUrl=new URL(ne.DEFAULT_GET_AUTH_TOKEN_URI,e.authorizationBaseUrl),this.expiringNotificationTimeInSeconds=e.expiringNotificationTimeInSeconds||ne.DEFAULT_EXPIRING_NOTIFICATION_TIME_IN_SECONDS}get authTokenData(){return this._authTokenData}getAuthToken(e){var t;return(t=this.authTokenData.get(e))==null?void 0:t.authToken}async authorize({address:e,authTokenSource:t=3,blockchain:r,authMessage:o=ne.DEFAULT_AUTH_MESSAGE}){if((t&1)===1){let u=this.getAuthToken(e)||await this.loadAuthTokenFromStore(e);if(u&&!this.isTokenExpiring(u))return u}if((t&2)!==2)return;let a=await this.signersManager.findSigner(e,r);if(!a)throw new Error(`Not found: the corresponding signer by the ${e} address`);let s=this.getAuthorizationTimeStamp(o),c=await a.sign(o+s);if(c.address!==e)throw new Error("Invalid address in the signed data");let m=await this.requestAuthToken({message:o,publicKey:c.publicKeyBytes,algorithm:c.algorithm,signingDataType:c.signingDataType,signature:c.signatureBytes,timeStamp:s}),l={value:m.token,userId:m.id,address:e,expired:new Date(m.expires)};return await this.registerAuthToken(l,!0),l}async unauthorize(e){let t=this.getAuthToken(e);return t?this.unregisterAuthToken(t):!1}dispose(){for(let e of this.authTokenData)this.untrackAuthToken(e[1].watcherId)}async loadAuthTokenFromStore(e){let t=await this.store.getAuthToken(e);if(!!t)return await this.registerAuthToken(t,!1)}async registerAuthToken(e,t){let r=this.trackAuthToken(e);if(!r)return;let o={authToken:e,watcherId:r};return this._authTokenData.set(e.address,o),t&&(e=await this.store.upsertAuthToken(e.address,e)),this.events.authorized.emit(e),e}async unregisterAuthToken(e){let t=this._authTokenData.get(e.address);if(!t)return!1;this.untrackAuthToken(t.watcherId);let r=await this.store.removeAuthToken(e)&&this._authTokenData.delete(e.address);return r&&this.events.unauthorized.emit(e),r}trackAuthToken(e){let t=e.expired.getTime()-Date.now();if(t<=0){this.store.removeAuthToken(e),this.events.authTokenExpired.emit(e);return}let r=t-this.expiringNotificationTimeInSeconds*1e3;return setTimeout(this.authTokenExpiringTimeoutCallback,Pe(r),e)}untrackAuthToken(e){clearTimeout(e)}getAuthorizationTimeStamp(e){return Date.now()}async requestAuthToken(e){let t=await fetch(this.authorizationUrl.href,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(await t.text());return t.json()}isTokenExpiring(e){return e.expired.getTime()-Date.now()<=this.expiringNotificationTimeInSeconds*1e3}},b=ne;i(b,"DEFAULT_AUTH_MESSAGE","Signing in "),i(b,"DEFAULT_GET_AUTH_TOKEN_URI","/v1/token"),i(b,"DEFAULT_EXPIRING_NOTIFICATION_TIME_IN_SECONDS",60);var R=class{mapAuthTokenToSerializedAuthToken(e){return{a:e.address,u:e.userId,e:e.expired.getTime(),v:e.value}}mapSerializedAuthTokenToAuthToken(e){return{address:e.a,userId:e.u,expired:new Date(e.e),value:e.v}}};var _e=class{constructor(e,t,r=_e.DefaultKeyPrefix){this.localStorage=e;this.serializedAuthTokenMapper=t;this.keyPrefix=r}getAuthToken(e){let t=localStorage.getItem(this.getKey(e));return t&&this.serializedAuthTokenMapper.mapSerializedAuthTokenToAuthToken(JSON.parse(t))||void 0}getAuthTokens(e){return e.map(t=>this.getAuthToken(t)).filter(Boolean)}upsertAuthToken(e,t){let r=this.serializedAuthTokenMapper.mapAuthTokenToSerializedAuthToken(t);if(!r)throw new Error(`The authToken of the ${e} address can't be stored: serialization is failed`);return localStorage.setItem(this.getKey(e),JSON.stringify(r)),t}removeAuthToken(e){return localStorage.removeItem(this.getKey(e)),!0}getKey(e){return this.keyPrefix+e}},oe=_e;i(oe,"DefaultKeyPrefix","authToken:");var Re=class{constructor(e,t,r=Re.DefaultKeyPrefix){this.localStorage=e;this.serializedAuthTokenMapper=t;this.keyPrefix=r}get key(){return this.keyPrefix}getAuthToken(e){let t=this.getSerializedAuthTokensStoreObject();return t[e]&&(this.serializedAuthTokenMapper.mapSerializedAuthTokenToAuthToken(t[e])||void 0)}getAuthTokens(e){let t=this.getSerializedAuthTokensStoreObject();return Object.values(t).map(r=>this.serializedAuthTokenMapper.mapSerializedAuthTokenToAuthToken(r)).filter(r=>!!r&&e.indexOf(r.address)>-1)}upsertAuthToken(e,t){let r=this.getSerializedAuthTokensStoreObject(),o=this.serializedAuthTokenMapper.mapAuthTokenToSerializedAuthToken(t);if(!o)throw new Error(`The authToken of the ${e} address can't be stored: serialization is failed`);return r[e]=o,this.localStorage.setItem(this.key,JSON.stringify(r)),t}removeAuthToken(e){let t=this.getSerializedAuthTokensStoreObject();return t[e]?(delete t[e],Object.keys(t).length?this.localStorage.setItem(this.key,JSON.stringify(t)):this.localStorage.removeItem(this.key),!0):!1}getSerializedAuthTokensStoreObject(){let e=this.localStorage.getItem(this.key);return e?JSON.parse(e):{}}},ie=Re;i(ie,"DefaultKeyPrefix","authTokens");var D=class{constructor(e="single-key",t=new R){i(this,"storeStrategy");this.storeStrategy=typeof e=="string"?this.createPreDefinedStoreStrategy(e,t):e}getAuthToken(e){return Promise.resolve(this.storeStrategy.getAuthToken(e))}getAuthTokens(...e){return Promise.resolve(this.storeStrategy.getAuthTokens(e))}upsertAuthToken(e,t){return Promise.resolve(this.storeStrategy.upsertAuthToken(e,t))}removeAuthToken(e){let t=typeof e=="string"?e:e.address;return Promise.resolve(this.storeStrategy.removeAuthToken(t))}createPreDefinedStoreStrategy(e,t){switch(e){case"single-key":return new ie(globalThis.localStorage,t);case"multiple-keys":return new oe(globalThis.localStorage,t);default:throw new Error(`Unknown the store strategy name: ${e}`)}}};var K=class{constructor(){i(this,"authTokensMap",new Map)}getAuthToken(e){return Promise.resolve(this.authTokensMap.get(e))}getAuthTokens(...e){return Promise.resolve(e.reduce((t,r)=>{let o=this.authTokensMap.get(r);return o&&t.push(o),t},[]))}upsertAuthToken(e,t){return this.authTokensMap.set(e,t),Promise.resolve(t)}removeAuthToken(e){let t=typeof e=="string"?e:e.address;return Promise.resolve(this.authTokensMap.delete(t))}};var De=(n,e,t)=>{let r=globalThis.window?"browser":"node";return new b({atomexNetwork:n.atomexNetwork,signersManager:n.managers.signersManager,authorizationBaseUrl:e.authorizationBaseUrl,store:r==="browser"?new D(e.store.browser.storeStrategy):new K})};var nt="https://api.atomex.me",kt={authorization:{authorizationBaseUrl:nt,store:{node:{},browser:{storeStrategy:"single-key"}}},exchange:{apiBaseUrl:nt,webSocketApiBaseUrl:"wss://ws.api.atomex.me"}},ot="https://api.test.atomex.me",bt={authorization:{authorizationBaseUrl:ot,store:{node:{},browser:{storeStrategy:"single-key"}}},exchange:{apiBaseUrl:ot,webSocketApiBaseUrl:"wss://ws.api.test.atomex.me"}},Ne={mainnet:kt,testnet:bt};var Se=class{constructor(e,t=new W(e.atomexNetwork)){this.options=e;this.atomexContext=t;i(this,"customAuthorizationManagerFactory");i(this,"customSignersManagerFactory");i(this,"customExchangeManagerFactory")}get controlledAtomexContext(){return this.atomexContext}useAuthorizationManager(e){return this.customAuthorizationManagerFactory=e,this}useSignersManager(e){return this.customSignersManagerFactory=e,this}useExchangeManager(e){return this.customExchangeManagerFactory=e,this}build(){this.controlledAtomexContext.managers.signersManager=this.createSignersManager(),this.controlledAtomexContext.managers.authorizationManager=this.createAuthorizationManager();let e=this.createDefaultExchangeService();return this.controlledAtomexContext.services.exchangeService=e,this.controlledAtomexContext.services.swapService=e,this.controlledAtomexContext.managers.exchangeManager=this.createExchangeManager(),this.controlledAtomexContext.managers.swapManager=this.createSwapManager(),new U({atomexContext:this.atomexContext,managers:{signersManager:this.atomexContext.managers.signersManager,authorizationManager:this.atomexContext.managers.authorizationManager,exchangeManager:this.atomexContext.managers.exchangeManager,swapManager:this.atomexContext.managers.swapManager}})}createAuthorizationManager(){let e=Ne[this.atomexContext.atomexNetwork].authorization;return this.customAuthorizationManagerFactory?this.customAuthorizationManagerFactory(this.atomexContext,e,this.options):De(this.atomexContext,e,this.options)}createSignersManager(){return this.customSignersManagerFactory?this.customSignersManagerFactory(this.atomexContext,this.options):new q(this.atomexContext.atomexNetwork)}createDefaultExchangeService(){let e=Ne[this.atomexContext.atomexNetwork].exchange;return Be(this.atomexContext,e)}createExchangeManager(){return this.customExchangeManagerFactory?this.customExchangeManagerFactory(this.atomexContext,this.options):new ye(this.atomexContext.services.exchangeService)}createSwapManager(){return new fe(this.atomexContext.services.swapService)}};import{ec as wt}from"elliptic";var Ie=null,At=()=>(Ie||(Ie=new wt("secp256k1")),Ie),Tt=n=>{let e=P.hexStringToUint8Array(n);if(e.length!==64&&e.length!==65)throw new Error(`Invalid signature: ${n}`);let t=e.length===64?27+(e[32]>>7):e[64];return(t===0||t===1)&&(t+=27),{r:he(e.slice(0,32)),s:he(e.slice(32,64)),v:t,recoveryParameter:1-t%2}},it=(n,e)=>{let t=Tt(n),r=C.from(e.startsWith("0x")?e.substring(2):e,"hex"),o=At().recoverPubKey(r,{r:t.r,s:t.s},t.recoveryParameter);return"0x"+o.encode("hex",!1)};var Ue=class{constructor(e,t){this.atomexNetwork=e;this.web3=t;i(this,"blockchain","ethereum")}async getAddress(){let t=(await this.web3.eth.getAccounts())[0];if(!t)throw new Error("Address is unavailable");return t}getPublicKey(){}async sign(e){let t=await this.getAddress(),r=await this.signInternal(e,t),o=it(r,this.web3.eth.accounts.hashMessage(e));return{address:t,publicKeyBytes:o.startsWith("0x")?o.substring(2):o,signatureBytes:r.substring(r.startsWith("0x")?2:0,r.length-2),algorithm:Ue.signingAlgorithm}}signInternal(e,t){return new Promise((r,o)=>this.web3.eth.personal.sign(e,t,"",(a,s)=>s?r(s):o(a)))}},Q=Ue;i(Q,"signingAlgorithm","Keccak256WithEcdsa:Geth2940");import{SigningType as Dt}from"@airgap/beacon-sdk";import{b58cdecode as Bt,prefix as _t,validatePkAndExtractPrefix as Rt}from"@taquito/utils";var S={};V(S,{decodeSignature:()=>ae,getRawMichelineSigningData:()=>Mt,getRawSigningData:()=>Et,getTezosSigningAlgorithm:()=>Ot,getWalletMichelineSigningData:()=>zt});import{b58cdecode as vt,prefix as Ct,Prefix as H}from"@taquito/utils";var Pt="54657a6f73205369676e6564204d6573736167653a20",st=(n,e)=>{let t=P.stringToHexString(n),r=e?e+t:t,o=J.padStart((r.length/2).toString(16),8,"0");return"0501"+o+r},Et=n=>P.stringToHexString(n),Mt=n=>st(n),zt=n=>st(n,Pt),Ot=n=>{let e=n.substring(0,n.startsWith("tz")?3:4);switch(e){case H.TZ1:case H.EDPK:return"Ed25519:Blake2b";case H.TZ2:case H.SPPK:return"Blake2bWithEcdsa:Secp256k1";case H.TZ3:case H.P2PK:return"Blake2bWithEcdsa:Secp256r1";default:throw new Error(`Unexpected address/public key prefix: ${e} (${n})`)}},ae=n=>{let e=n.startsWith("sig")?n.substring(0,3):n.substring(0,5),t=vt(n,Ct[e]);return Buffer.from(t).toString("hex")};var j=n=>{let e=Rt(n),t=Bt(n,_t[e]);return C.from(t).toString("hex")};var xe=class{constructor(e,t){this.atomexNetwork=e;this.beaconWallet=t;i(this,"blockchain","tezos")}getAddress(){return this.beaconWallet.getPKH()}async getPublicKey(){var e;return(e=await this.beaconWallet.client.getActiveAccount())==null?void 0:e.publicKey}async sign(e){let[t,r,o]=await Promise.all([this.getAddress(),this.getPublicKey(),this.beaconWallet.client.requestSignPayload({payload:S.getWalletMichelineSigningData(e),signingType:Dt.MICHELINE})]);if(!r)throw new Error("BeaconWallet: public key is unavailable");let a=S.getTezosSigningAlgorithm(r),s=j(r),c=ae(o.signature);return{address:t,algorithm:a,publicKeyBytes:s,signatureBytes:c,signingDataType:"tezos/wallet-micheline"}}};var ke=class{constructor(e,t){this.atomexNetwork=e;this.templeWallet=t;i(this,"blockchain","tezos")}getAddress(){return this.templeWallet.getPKH()}getPublicKey(){var e;return(e=this.templeWallet.permission)==null?void 0:e.publicKey}async sign(e){let[t,r,o]=await Promise.all([this.getAddress(),this.getPublicKey(),this.templeWallet.sign(S.getWalletMichelineSigningData(e))]);if(!r)throw new Error("TempleWallet: public key is unavailable");let a=S.getTezosSigningAlgorithm(r),s=j(r),c=ae(o);return{address:t,algorithm:a,publicKeyBytes:s,signatureBytes:c,signingDataType:"tezos/wallet-micheline"}}};var se=class{constructor(e,t){this.atomexNetwork=e;this.wallet=t;i(this,"blockchain","tezos");i(this,"internalSigner");this.internalSigner=this.createInternalSigner()}getAddress(){return this.internalSigner.getAddress()}getPublicKey(){return this.internalSigner.getPublicKey()}sign(e){return this.internalSigner.sign(e)}createInternalSigner(){var e;if(((e=this.wallet.client)==null?void 0:e.name)!==void 0)return new xe(this.atomexNetwork,this.wallet);if(this.wallet.permission!==void 0&&this.wallet.connected!==void 0)return new ke(this.atomexNetwork,this.wallet);throw new Error("Unknown Tezos wallet")}};import{InMemorySigner as Nt}from"@taquito/signer";var be=class{constructor(e,t){this.atomexNetwork=e;i(this,"blockchain","tezos");i(this,"internalInMemorySigner");this.internalInMemorySigner=new Nt(t)}getAddress(){return this.internalInMemorySigner.publicKeyHash()}getPublicKey(){return this.internalInMemorySigner.publicKey()}async sign(e){let t=S.getRawSigningData(e),[r,o,a]=await Promise.all([this.getAddress(),this.getPublicKey(),this.internalInMemorySigner.sign(t)]),s=j(o),c=a.sbytes.substring(a.bytes.length),m=S.getTezosSigningAlgorithm(o);return{address:r,algorithm:m,publicKeyBytes:s,signatureBytes:c}}};var We={};V(We,{Atomex:()=>ce,EthereumHelpers:()=>me,FA12Helpers:()=>ue,FA2Helpers:()=>le,Helpers:()=>N,TezosHelpers:()=>w,dt2ts:()=>M,now:()=>de});var d={api:{mainnet:{baseUrl:"https://api.atomex.me"},testnet:{baseUrl:"https://api.test.atomex.me"},localhost:{baseUrl:"http://127.0.0.1:5000"}},blockchains:{ethereum:{rpc:{mainnet:{chainID:1,rpc:"https://mainnet.infura.io/v3/7cd728d2d3384719a630d836f1693c5c",blockTime:10},testnet:{chainID:5,rpc:"https://goerli.infura.io/v3/7cd728d2d3384719a630d836f1693c5c",blockTime:10}}},tezos:{rpc:{mainnet:{chainID:"NetXdQprcVkpaWU",rpc:"https://rpc.tzkt.io/mainnet/",blockTime:30,minimalFees:100,minimalNanotezPerGasUnit:.1,minimalNanotezPerByte:1,costPerByte:250},testnet:{chainID:"NetXnHfVqm9iesp",rpc:"https://rpc.tzkt.io/ithacanet/",blockTime:15,minimalFees:100,minimalNanotezPerGasUnit:.1,minimalNanotezPerByte:1,costPerByte:250}}}},currencies:{ETH:{contracts:{mainnet:{address:"0xe9c251cbb4881f9e056e40135e7d3ea9a7d037df",gasLimit:2e5},testnet:{address:"0x512fe6B803bA327DCeFBF2Cec7De333f761B0f2b",gasLimit:17e4},abi:[{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"_hashedSecret",type:"bytes32"}],name:"Activated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"_hashedSecret",type:"bytes32"},{indexed:!1,internalType:"address",name:"_sender",type:"address"},{indexed:!1,internalType:"uint256",name:"_value",type:"uint256"}],name:"Added",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"_hashedSecret",type:"bytes32"},{indexed:!0,internalType:"address",name:"_participant",type:"address"},{indexed:!1,internalType:"address",name:"_initiator",type:"address"},{indexed:!1,internalType:"uint256",name:"_refundTimestamp",type:"uint256"},{indexed:!1,internalType:"uint256",name:"_countdown",type:"uint256"},{indexed:!1,internalType:"uint256",name:"_value",type:"uint256"},{indexed:!1,internalType:"uint256",name:"_payoff",type:"uint256"},{indexed:!1,internalType:"bool",name:"_active",type:"bool"}],name:"Initiated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"_hashedSecret",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"_secret",type:"bytes32"}],name:"Redeemed",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"_hashedSecret",type:"bytes32"}],name:"Refunded",type:"event"},{constant:!0,inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"swaps",outputs:[{internalType:"bytes32",name:"hashedSecret",type:"bytes32"},{internalType:"address payable",name:"initiator",type:"address"},{internalType:"address payable",name:"participant",type:"address"},{internalType:"uint256",name:"refundTimestamp",type:"uint256"},{internalType:"uint256",name:"countdown",type:"uint256"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"payoff",type:"uint256"},{internalType:"bool",name:"active",type:"bool"},{internalType:"enum Atomex.State",name:"state",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_hashedSecret",type:"bytes32"},{internalType:"address payable",name:"_participant",type:"address"},{internalType:"uint256",name:"_refundTimestamp",type:"uint256"},{internalType:"uint256",name:"_payoff",type:"uint256"}],name:"initiate",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_hashedSecret",type:"bytes32"}],name:"add",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_hashedSecret",type:"bytes32"}],name:"activate",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_hashedSecret",type:"bytes32"},{internalType:"bytes32",name:"_secret",type:"bytes32"}],name:"redeem",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_hashedSecret",type:"bytes32"}],name:"refund",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"}]},decimals:{original:18,displayed:4},blockchain:"ethereum"},XTZ:{contracts:{mainnet:{address:"KT1VG2WtYdSWz5E7chTeAdDPZNy2MpP8pTfL",redeemTxSize:133,initiateTxSize:200,gasLimit:15e3},testnet:{address:"KT1SJMtHZFSPva5AzQEx5btBuQ8BjvXqort3",redeemTxSize:133,initiateTxSize:200,gasLimit:85e3},entrypoints:{default:{prim:"or",args:[{prim:"or",args:[{prim:"pair",args:[{prim:"address",annots:["%participant"]},{prim:"pair",args:[{prim:"pair",args:[{prim:"bytes",annots:["%hashed_secret"]},{prim:"timestamp",annots:["%refund_time"]}]},{prim:"mutez",annots:["%payoff"]}],annots:["%settings"]}],annots:[":initiate","%initiate"]},{prim:"bytes",annots:[":hashed_secret","%add"]}],annots:["%fund"]},{prim:"or",args:[{prim:"bytes",annots:[":secret","%redeem"]},{prim:"bytes",annots:[":hashed_secret","%refund"]}],annots:["%withdraw"]}]},withdraw:{prim:"or",args:[{prim:"bytes",annots:[":secret","%redeem"]},{prim:"bytes",annots:[":hashed_secret","%refund"]}]},refund:{prim:"bytes",annots:[":hashed_secret"]},redeem:{prim:"bytes",annots:[":secret"]},initiate:{prim:"pair",args:[{prim:"address",annots:["%participant"]},{prim:"pair",args:[{prim:"pair",args:[{prim:"bytes",annots:["%hashed_secret"]},{prim:"timestamp",annots:["%refund_time"]}]},{prim:"mutez",annots:["%payoff"]}],annots:["%settings"]}],annots:[":initiate"]},fund:{prim:"or",args:[{prim:"pair",args:[{prim:"address",annots:["%participant"]},{prim:"pair",args:[{prim:"pair",args:[{prim:"bytes",annots:["%hashed_secret"]},{prim:"timestamp",annots:["%refund_time"]}]},{prim:"mutez",annots:["%payoff"]}],annots:["%settings"]}],annots:[":initiate","%initiate"]},{prim:"bytes",annots:[":hashed_secret","%add"]}]},add:{prim:"bytes",annots:[":hashed_secret"]}}},decimals:{original:6,displayed:3},blockchain:"tezos"},TZBTC:{contracts:{mainnet:{address:"KT1Ap287P1NzsnToSJdA4aqSNjPomRaHBZSr",tokenAddress:"KT1PWx2mnDueood7fEmfbBDKx1D9BAnnXitn",redeemTxSize:133,initiateTxSize:250,gasLimit:1e5},testnet:{address:"KT1Jj1jzDQbDRHt4u7M73DUrBDV1napRbNFr",tokenAddress:"",redeemTxSize:133,initiateTxSize:250,gasLimit:1e5},entrypoints:{default:{prim:"or",args:[{prim:"or",args:[{prim:"pair",args:[{prim:"pair",args:[{prim:"pair",args:[{prim:"bytes",annots:["%hashedSecret"]},{prim:"address",annots:["%participant"]}]},{prim:"pair",args:[{prim:"nat",annots:["%payoffAmount"]},{prim:"timestamp",annots:["%refundTime"]}]}]},{prim:"pair",args:[{prim:"address",annots:["%tokenAddress"]},{prim:"nat",annots:["%totalAmount"]}]}],annots:["%initiate"]},{prim:"bytes",annots:["%redeem"]}]},{prim:"bytes",annots:["%refund"]}]},refund:{prim:"bytes"},redeem:{prim:"bytes"},initiate:{prim:"pair",args:[{prim:"pair",args:[{prim:"pair",args:[{prim:"bytes",annots:["%hashedSecret"]},{prim:"address",annots:["%participant"]}]},{prim:"nat",annots:["%payoffAmount"]},{prim:"timestamp",annots:["%refundTime"]}]},{prim:"address",annots:["%tokenAddress"]},{prim:"nat",annots:["%totalAmount"]}]}}},decimals:{original:8,displayed:4},blockchain:"tezos"},USDT_XTZ:{contracts:{mainnet:{address:"KT1Ays1Chwx3ArnHGoQXchUgDsvKe9JboUjj",tokenAddress:"KT1XnTn74bUtxHfDtBmm2bGZAQfhPbvKWR8o",redeemTxSize:2e4,initiateTxSize:2e4,gasLimit:4e5},testnet:{address:"KT1HHjNxi3okxxGJT1SPPhpcs3gMQt8hqixY",tokenAddress:"KT1BWvRQnVVowZZLGkct9A7sdj5YEe8CdUhR",redeemTxSize:2e4,initiateTxSize:2e4,gasLimit:4e5},entrypoints:{default:{prim:"or",args:[{prim:"or",args:[{prim:"pair",args:[{prim:"pair",args:[{prim:"pair",args:[{prim:"bytes",annots:["%hashedSecret"]},{prim:"address",annots:["%participant"]}]},{prim:"pair",args:[{prim:"nat",annots:["%payoffAmount"]},{prim:"timestamp",annots:["%refundTime"]}]}]},{prim:"pair",args:[{prim:"pair",args:[{prim:"address",annots:["%tokenAddress"]},{prim:"nat",annots:["%tokenId"]}]},{prim:"nat",annots:["%totalAmount"]}]}],annots:["%initiate"]},{prim:"bytes",annots:["%redeem"]}]},{prim:"bytes",annots:["%refund"]}]},refund:{prim:"bytes"},redeem:{prim:"bytes"},initiate:{prim:"pair",args:[{prim:"pair",args:[{prim:"pair",args:[{prim:"bytes",annots:["%hashedSecret"]},{prim:"address",annots:["%participant"]}]},{prim:"nat",annots:["%payoffAmount"]},{prim:"timestamp",annots:["%refundTime"]}]},{prim:"pair",args:[{prim:"address",annots:["%tokenAddress"]},{prim:"nat",annots:["%tokenId"]}]},{prim:"nat",annots:["%totalAmount"]}]}}},decimals:{original:6,displayed:4},blockchain:"tezos"}}};var ce=class{constructor(e,t,r){i(this,"_network");i(this,"_baseUrl");i(this,"_authToken");i(this,"_authorizationManager");this._network=e,this._baseUrl=t,this._authToken=r}static create(e){return new ce(e=="mainnet"?"mainnet":"testnet",d.api[e].baseUrl)}setAuthorizationManager(e){this._authorizationManager=e}getLocalAuthToken(e){var r;let t=(r=this._authorizationManager)==null?void 0:r.getAuthToken(e);return t==null?void 0:t.value}setAuthToken(e){this._authToken=e}async makeRequest(e,t,r=!1,o,a){let s=new URL(t,this._baseUrl);o!==void 0&&Object.keys(o).forEach(u=>s.searchParams.append(u,o[u]));let c={};if(r){let u=typeof r=="string"?this.getLocalAuthToken(r):this._authToken;if(!u)throw new Error("Auth token is undefined");c.Authorization=`Bearer ${u}`}let m;e==="post"&&a!==void 0&&(m=JSON.stringify(a),c["Content-Type"]="application/json");let l=await fetch(s.toString(),{method:e,headers:c,body:m});if(l.ok)return l.json();{let u=await l.text();throw Error(u)}}async getAuthToken(e){return this.makeRequest("post","/v1/Token",!1,{},e)}async getSymbols(){return this.makeRequest("get","/v1/Symbols",!1)}async getQuotes(e){let t=e!==void 0&&e.length>0?e.join(","):"All";return this.makeRequest("get","/v1/MarketData/quotes",!1,{symbols:t})}async getOrderBook(e){return this.makeRequest("get","/v1/MarketData/book",!1,{symbol:e})}async addOrder(e){var a;let[t,r]=this.splitSymbol(e.symbol).map(s=>this.getCurrencyConfig(s)),o=e;return o.requisites=f({baseCurrencyContract:t.contractAddress,quoteCurrencyContract:r.contractAddress},o.requisites),this.makeRequest("post","/v1/Orders",((a=e.requisites)==null?void 0:a.receivingAddress)||!0,{},o).then(s=>s.orderId)}async getOrders(e,t){return this.makeRequest("get","/v1/Orders",e||!0,f({},t))}async getOrder(e,t){return this.makeRequest("get",`/v1/Orders/${e}`,t||!0)}async cancelOrder(e,t,r,o){return this.makeRequest("delete",`/v1/Orders/${e}`,o||!0,{symbol:t,side:r}).then(a=>a.result)}async addSwapRequisites(e,t){return this.makeRequest("post",`/v1/Swaps/${e}/requisites`,(t==null?void 0:t.receivingAddress)||!0,{},t).then(r=>r.result)}async getSwaps(e,t){return this.makeRequest("get","/v1/Swaps",e||!0,f({},t))}async getSwap(e,t){return this.makeRequest("get",`/v1/Swaps/${e}`,t||!0)}getOrderPreview(e,t,r,o){let a=e.entries.filter(m=>m.side==t?!1:(()=>{switch(t+o){case"BuySend":case"SellReceive":return r/m.price;default:return r}})()<=Math.max(...m.qtyProfile)).map(m=>m.price);if(a.length==0)throw new Error(`No matching order found (${o} ${r} / ${t})`);let s=t=="Buy"?Math.min(...a):Math.max(...a),c=()=>{switch(t+o){case"BuySend":case"SellReceive":return r/s;default:return r*s}};return{price:s,amountSent:o=="Send"?r:c(),amountReceived:o=="Receive"?r:c()}}splitSymbol(e){let[t,r]=e.split("/",2);if(!t||!r)throw new Error("Symbol is invalid");return[t,r]}getCurrencyConfig(e){let t=Object.entries(d.currencies).find(([r,o])=>r==e);if(t==null)throw new Error(`No matching config section for ${e}`);return{blockchain:t[1].blockchain,decimals:t[1].decimals.original,displayDecimals:t[1].decimals.displayed,contractAddress:t[1].contracts[this._network].address,tokenAddress:t[1].contracts[this._network].tokenAddress}}formatAmount(e,t){let r=this.getCurrencyConfig(t);return parseFloat(typeof e=="string"?parseFloat(e).toFixed(r.displayDecimals):e.toFixed(r.displayDecimals))}getOrderSide(e,t,r){let[o,a]=this.splitSymbol(e);if(o===t&&a===r)return"Sell";if(a===t&&o===r)return"Buy";throw new Error(`Mismatch ${t} => ${r} (${e})`)}getMaxOrderSize(e,t){return Math.max(...e.entries.filter(r=>r.side!=t).map(r=>Math.max(...r.qtyProfile)))}};import Ut from"elliptic";import Wt from"web3";var N=class{},M=n=>Math.round(new Date(n).getTime()/1e3),de=()=>Math.round(Date.now()/1e3);var me=class extends N{constructor(t,r,o,a,s){super();i(this,"_web3");i(this,"_contract");i(this,"_timeBetweenBlocks");i(this,"_functions");i(this,"_gasLimit");this._web3=t,this._contract=new t.eth.Contract(r,o),this._timeBetweenBlocks=a,this._gasLimit=s,this._functions=new Map,r.forEach(c=>{c.type==="function"&&this._functions.set(c.name,{types:c.inputs,signature:t.eth.abi.encodeFunctionSignature(c)})})}static async create(t,r){let o=d.blockchains.ethereum.rpc[t];r!==void 0&&(o.rpc=r);let a=new Wt(o.rpc),s=await a.eth.getChainId();if(o.chainID!==s)throw new Error(`Wrong chain ID: expected ${o.chainID}, actual ${s}`);return new me(a,d.currencies.ETH.contracts.abi,d.currencies.ETH.contracts[t].address,o.blockTime,d.currencies.ETH.contracts[t].gasLimit)}getAuthMessage(t,r){let o=Date.now();return{message:t,timestamp:o,msgToSign:t+o.toString(),algorithm:"Keccak256WithEcdsa:Geth2940"}}buildInitiateTransaction(t){if(t.refundTimestamp<de())throw new Error(`Swap timestamp is in the past: ${t.refundTimestamp}`);return{data:this._contract.methods.initiate("0x"+t.secretHash,t.receivingAddress,t.refundTimestamp,t.rewardForRedeem).encodeABI(),contractAddr:this._contract.options.address,amount:t.netAmount+t.rewardForRedeem}}buildRedeemTransaction(t,r){return{data:this._contract.methods.redeem(r,t).encodeABI(),contractAddr:this._contract.options.address}}buildRefundTransaction(t){return{data:this._contract.methods.refund(t).encodeABI(),contractAddr:this._contract.options.address}}buildAddTransaction(t,r){return{data:this._contract.methods.add(t).encodeABI(),contractAddr:this._contract.options.address,amount:r}}buildActivateTransaction(t){return{data:this._contract.methods.activate(t).encodeABI(),contractAddr:this._contract.options.address}}parseInitiateParameters(t){let r=this._functions.get("initiate");if(!t.input.startsWith(r.signature))throw new Error(`Unexpected method signature: ${t.input}`);let o=this._web3.eth.abi.decodeParameters(r.types,t.input.slice(r.signature.length));return{secretHash:o._hashedSecret.slice(2),receivingAddress:o._participant,refundTimestamp:parseInt(o._refundTimestamp),rewardForRedeem:parseInt(this._web3.utils.toBN(o._payoff).toString()),netAmount:parseInt(this._web3.utils.toBN(t.value).sub(this._web3.utils.toBN(o._payoff)).toString())}}async validateInitiateTransaction(t,r,o,a,s,c,m,l=2){let u=s-c,g=await this._web3.eth.getTransaction(r);try{if(g===void 0)throw new Error(`Failed to retrieve transaction: ${r}`);if(g.to!==this._contract.options.address)throw new Error(`Wrong contract address: ${g.to}`);let y=this.parseInitiateParameters(g);if(y.secretHash!==o)throw new Error(`Secret hash: expect ${o}, actual ${y.secretHash}`);if(y.receivingAddress.toLowerCase()!==a.toLowerCase())throw new Error(`Receiving address: expect ${a}, actual ${y.receivingAddress}`);if(y.netAmount!==u)throw new Error(`Net amount: expect ${u}, actual ${y.netAmount}`);if(y.refundTimestamp<m)throw new Error(`Refund timestamp: minimum ${m}, actual ${y.refundTimestamp}`)}catch(y){return{status:"Invalid",message:y.message,confirmations:0,nextBlockETA:0}}let A=await this._web3.eth.getBlock("latest"),I=A.number-(g.blockNumber||A.number),z={status:g.blockNumber!==void 0?"Included":"Pending",confirmations:I,nextBlockETA:parseInt(A.timestamp.toString())+this._timeBetweenBlocks};return I>=l&&(z.status="Confirmed"),z}hexSlice(t,r,o){return"0x"+o.slice(t*2+2,r*2+2)}getVRS(t){let r=[this.hexSlice(64,(t.length-2)/2,t),this.hexSlice(0,32,t),this.hexSlice(32,64,t)];return{v:parseInt(r[0].slice(2),16),r:r[1].slice(2),s:r[2].slice(2)}}recoverPublicKey(t,r){let o=this._web3.eth.accounts.hashMessage(t),a=this.getVRS(r),c=new Ut.ec("secp256k1").recoverPubKey(Buffer.from(o.slice(2),"hex"),a,a.v<2?a.v:1-a.v%2);return"0x"+c.encode("hex",!1)}encodePublicKey(t){return t.startsWith("0x")?t.slice(2):t}encodeSignature(t){let r=this.getVRS(t);return r.r.padStart(64,"0")+r.s.padStart(64,"0")}async estimateInitiateFees(t){let r={receivingAddress:"0x0000000000000000000000000000000000000000",secretHash:"0000000000000000000000000000000000000000000000000000000000000000",refundTimestamp:2147483647,rewardForRedeem:0,netAmount:0},o=this.buildInitiateTransaction(r),a=await this._web3.eth.getGasPrice(),s=await this._web3.eth.estimateGas({from:t,to:o.contractAddr,data:o.data,value:o.amount});return parseInt(a)*s}async estimateRedeemFees(t){let r=await this._web3.eth.getGasPrice(),o=parseInt(r)*this._gasLimit;return{totalCost:o,rewardForRedeem:2*o}}isValidAddress(t){return this._web3.utils.isAddress(t)}};import{ParameterSchema as qt}from"@taquito/michelson-encoder";import{OpKind as Ft}from"@taquito/rpc";import{TezosToolkit as Lt}from"@taquito/taquito";import{b58cdecode as we,prefix as pe,validateAddress as $t,ValidationResult as Kt}from"@taquito/utils";var Qt=n=>new Date(n*1e3).toISOString().slice(0,-5)+"Z",w=class extends N{constructor(t,r,o,a,s,c,m,l,u,g,A){super();i(this,"_tezos");i(this,"_contractAddress");i(this,"_timeBetweenBlocks");i(this,"_entrypoints");i(this,"_gasLimit");i(this,"_minimalFees");i(this,"_minimalNanotezPerGasUnit");i(this,"_minimalNanotezPerByte");i(this,"_costPerByte");i(this,"_redeemTxSize");i(this,"_initiateTxSize");this._tezos=t,this._contractAddress=o,this._timeBetweenBlocks=a,this._gasLimit=s,this._minimalFees=c,this._minimalNanotezPerGasUnit=m,this._minimalNanotezPerByte=l,this._costPerByte=u,this._redeemTxSize=g,this._initiateTxSize=A,this._entrypoints=new Map(Object.entries(r).map(([I,z])=>[I,new qt(z)]))}static async create(t,r="XTZ",o){let a=d.blockchains.tezos.rpc[t];o!==void 0&&(a.rpc=o);let s=new Lt(a.rpc),c=await s.rpc.getChainId();if(a.chainID!==c.toString())throw new Error(`Wrong chain ID: expected ${a.chainID}, actual ${c}`);return new w(s,d.currencies[r].contracts.entrypoints,d.currencies[r].contracts[t].address,d.blockchains.tezos.rpc[t].blockTime,d.currencies[r].contracts[t].gasLimit,d.blockchains.tezos.rpc[t].minimalFees,d.blockchains.tezos.rpc[t].minimalNanotezPerGasUnit,d.blockchains.tezos.rpc[t].minimalNanotezPerByte,d.blockchains.tezos.rpc[t].costPerByte,d.currencies[r].contracts[t].redeemTxSize,d.currencies[r].contracts[t].initiateTxSize)}getTezosAlgorithm(t){switch(t){case"tz1":return"Ed25519:Blake2b";case"tz2":return"Blake2bWithEcdsa:Secp256k1";case"tz3":return"Blake2bWithEcdsa:Secp256r1";default:throw new Error(`Unexpected address prefix: ${t}`)}}getAuthMessage(t,r){let o=Date.now();return{message:t,timestamp:o,msgToSign:t+o.toString(),algorithm:this.getTezosAlgorithm(r.slice(0,3))}}buildInitiateTransaction(t){var o;if(t.refundTimestamp<de())throw new Error(`Swap timestamp is in the past: ${t.refundTimestamp}`);let r=(o=this._entrypoints.get("initiate"))==null?void 0:o.Encode(t.receivingAddress,t.secretHash,Qt(t.refundTimestamp),t.rewardForRedeem);return{data:{entrypoint:"initiate",value:r},contractAddr:this._contractAddress,amount:t.netAmount+t.rewardForRedeem}}buildRedeemTransaction(t,r=""){var o;return{data:{entrypoint:"redeem",value:(o=this._entrypoints.get("redeem"))==null?void 0:o.Encode(t)},contractAddr:this._contractAddress}}buildRefundTransaction(t){var r;return{data:{entrypoint:"refund",value:(r=this._entrypoints.get("refund"))==null?void 0:r.Encode(t)},contractAddr:this._contractAddress}}buildAddTransaction(t,r){var o;return{amount:r,data:{entrypoint:"add",value:(o=this._entrypoints.get("add"))==null?void 0:o.Encode(t)},contractAddr:this._contractAddress}}getBlockDetails(t){return{level:t.metadata.level_info.level,timestamp:M(t.header.timestamp)}}parseInitiateParameters(t){var a;if(t.parameters===void 0)throw new Error("Parameters are undefined");let r=(a=this._entrypoints.get(t.parameters.entrypoint))==null?void 0:a.Execute(t.parameters.value);if(r===void 0)throw new Error(`Unexpected entrypoint: ${t.parameters.entrypoint}`);let o=(()=>{switch(t.parameters.entrypoint){case"initiate":return r;case"fund":case"default":return r.initiate;default:throw new Error(`Unexpected entrypoint: ${t.parameters.entrypoint}`)}})();return{secretHash:o.settings.hashed_secret,receivingAddress:o.participant,refundTimestamp:M(o.settings.refund_time),netAmount:parseInt(t.amount)-parseInt(o.settings.payoff),rewardForRedeem:parseInt(o.settings.payoff)}}findContractCall(t,r){var s;let o=(s=t.operations[3])==null?void 0:s.find(c=>c.hash==r);if(o===void 0)throw new Error(`Operation not found: ${r} @ ${t.hash}`);let a=o.contents.filter(c=>c.kind=="transaction"&&c.destination==this._contractAddress);if(a.length===0)throw new Error("Unsupported contract version is used");return a}async validateInitiateTransaction(t,r,o,a,s,c,m,l=2){let u=s-c,g=await this._tezos.rpc.getBlock({block:t.toString()});try{if(this.findContractCall(g,r).find(G=>{let T=this.parseInitiateParameters(G);return T.secretHash!==o?(console.log(`[${G.counter}] Secret hash: expect ${o}, actual ${T.secretHash}`),!1):T.receivingAddress.toLowerCase()!==a.toLowerCase()?(console.log(`[${G.counter}] Receiving address: expect ${a}, actual ${T.receivingAddress}`),!1):T.netAmount!==u?(console.log(`[${G.counter}] Net amount: expect ${u}, actual ${T.netAmount}`),!1):T.refundTimestamp<m?(console.log(`[${G.counter}] Refund timestamp: minimum ${m}, actual ${T.refundTimestamp}`),!1):!0},this)===void 0)throw new Error(`Initiate transaction that satisfies the expected criteria is not found in ${r} contents`)}catch(qe){return{status:"Invalid",message:qe.message,confirmations:0,nextBlockETA:0}}let A=this.getBlockDetails(await this._tezos.rpc.getBlock({block:"head"})),I=this.getBlockDetails(g),z=A.level-I.level,y={status:"Included",confirmations:z,nextBlockETA:A.timestamp+this._timeBetweenBlocks};return z>=l&&(y.status="Confirmed"),y}encodePublicKey(t){switch(t.substring(0,2)){case"ed":return Buffer.from(we(t,pe.edpk)).toString("hex");case"p2":return Buffer.from(we(t,pe.p2pk)).toString("hex");case"sp":return Buffer.from(we(t,pe.sppk)).toString("hex");default:throw new Error("Unsupported Public Key Type")}}encodeSignature(t){var o;let r=t.startsWith("sig")?t.substring(0,3):t.substring(0,5);if(Object.prototype.hasOwnProperty.call(pe,r))return Buffer.from(we(t,(o=Object.getOwnPropertyDescriptor(pe,r))==null?void 0:o.value)).toString("hex");throw new Error("Unsupported Signature Type")}calcFees(t=0,r=0,o=0){return this._minimalFees+this._minimalNanotezPerGasUnit*t+this._minimalNanotezPerByte*o+r*this._costPerByte}async estimateInitiateFees(t){let r={receivingAddress:"tz1Q2prWCrDGFDuGTe7axdt4z9e3QkCqdhmD",secretHash:"169cbd29345af89a0983f28254e71bdd1367890b9876fc8a9ea117c32f6a521b",refundTimestamp:2147483647,rewardForRedeem:0,netAmount:100},o=this.buildInitiateTransaction(r),a=await this._tezos.rpc.getBlockHeader(),s=await this._tezos.rpc.getContract(t),c=await this._tezos.rpc.runOperation({chain_id:a.chain_id,operation:{branch:a.hash,signature:"sigUHx32f9wesZ1n2BWpixXz4AQaZggEtchaQNHYGRCoWNAXx45WGW2ua3apUUUAGMLPwAU41QoaFCzVSL61VaessLg4YbbP",contents:[{amount:"0",counter:(parseInt(s.counter||"0")+1).toString(),destination:this._contractAddress,fee:this.calcFees(104e4,6e4,this._initiateTxSize).toString(),gas_limit:"1040000",kind:Ft.TRANSACTION,source:t,storage_limit:"60000",parameters:o.data}]}}),m=0,l=0;return c.contents.forEach(u=>{if(u.metadata.operation_result.status!=="applied")throw new Error("Some error was encountered while estimating fees");l+=parseInt(u.metadata.operation_result.consumed_gas||"0"),m+=parseInt(u.metadata.operation_result.paid_storage_size_diff||"0")}),this.calcFees(l,m,this._initiateTxSize)}async estimateRedeemFees(t){let r=this.calcFees(this._gasLimit,0,this._redeemTxSize);return await this._tezos.rpc.getManagerKey(t)===null&&(r+=257*this._costPerByte),{totalCost:r,rewardForRedeem:2*r}}isValidAddress(t){return $t(t)==Kt.VALID}};import{TezosToolkit as Ht}from"@taquito/taquito";var ue=class extends w{static async create(e,t,r){let o=d.blockchains.tezos.rpc[e];r!==void 0&&(o.rpc=r);let a=new Ht(o.rpc),s=await a.rpc.getChainId();if(o.chainID!==s.toString())throw new Error(`Wrong chain ID: expected ${o.chainID}, actual ${s}`);return new ue(a,d.currencies[t].contracts.entrypoints,d.currencies[t].contracts[e].address,d.blockchains.tezos.rpc[e].blockTime,d.currencies[t].contracts[e].gasLimit,d.blockchains.tezos.rpc[e].minimalFees,d.blockchains.tezos.rpc[e].minimalNanotezPerGasUnit,d.blockchains.tezos.rpc[e].minimalNanotezPerByte,d.blockchains.tezos.rpc[e].costPerByte,d.currencies[t].contracts[e].redeemTxSize,d.currencies[t].contracts[e].initiateTxSize)}parseInitiateParameters(e){var o;if(e.parameters===void 0)throw new Error("Parameters are undefined");let t=(o=this._entrypoints.get(e.parameters.entrypoint))==null?void 0:o.Execute(e.parameters.value);if(t===void 0)throw new Error(`Unexpected entrypoint: ${e.parameters.entrypoint}`);let r=(()=>{switch(e.parameters.entrypoint){case"initiate":return t;case"default":return t.initiate;default:throw new Error(`Unexpected entrypoint: ${e.parameters.entrypoint}`)}})();return{secretHash:r.hashedSecret,receivingAddress:r.participant,refundTimestamp:M(r.refundTime),netAmount:parseInt(r.totalAmount)-parseInt(r.payoffAmount),rewardForRedeem:parseInt(r.payoffAmount)}}};import{TezosToolkit as jt}from"@taquito/taquito";var le=class extends w{static async create(e,t,r){let o=d.blockchains.tezos.rpc[e];r!==void 0&&(o.rpc=r);let a=new jt(o.rpc),s=await a.rpc.getChainId();if(o.chainID!==s.toString())throw new Error(`Wrong chain ID: expected ${o.chainID}, actual ${s}`);return new le(a,d.currencies[t].contracts.entrypoints,d.currencies[t].contracts[e].address,d.blockchains.tezos.rpc[e].blockTime,d.currencies[t].contracts[e].gasLimit,d.blockchains.tezos.rpc[e].minimalFees,d.blockchains.tezos.rpc[e].minimalNanotezPerGasUnit,d.blockchains.tezos.rpc[e].minimalNanotezPerByte,d.blockchains.tezos.rpc[e].costPerByte,d.currencies[t].contracts[e].redeemTxSize,d.currencies[t].contracts[e].initiateTxSize)}parseInitiateParameters(e){var o;if(!e.parameters)throw new Error("Parameters are undefined");let t=(o=this._entrypoints.get(e.parameters.entrypoint))==null?void 0:o.Execute(e.parameters.value);if(!t)throw new Error(`Unexpected entrypoint: ${e.parameters.entrypoint}`);let r=this.getInitiateParams(e.parameters.entrypoint,t);return{secretHash:r.hashedSecret,receivingAddress:r.participant,refundTimestamp:M(r.refundTime),netAmount:parseInt(r.totalAmount)-parseInt(r.payoffAmount),rewardForRedeem:parseInt(r.payoffAmount)}}getInitiateParams(e,t){switch(e){case"initiate":return t;case"default":return t.initiate;default:throw new Error(`Unexpected entrypoint: ${e}`)}}};export{U as Atomex,Se as AtomexBuilder,re as AuthTokenSource,b as AuthorizationManager,R as DefaultSerializedAuthTokenMapper,Z as ImportantDataReceivingMode,K as InMemoryAuthorizationManagerStore,ge as InMemoryCurrenciesProvider,be as InMemoryTezosSigner,D as LocalStorageAuthorizationManagerStore,$ as MixedApiAtomexClient,O as RestAtomexClient,q as SignersManager,se as WalletTezosSigner,Q as Web3EthereumSigner,_ as WebSocketAtomexClient,k as atomexUtils,P as converters,We as legacy,Pe as prepareTimeoutDuration,J as textUtils,ar as wait};
//# sourceMappingURL=index.js.map
