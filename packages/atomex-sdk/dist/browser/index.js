var Vt=Object.defineProperty,vr=Object.defineProperties;var Br=Object.getOwnPropertyDescriptors;var Ut=Object.getOwnPropertySymbols;var Cr=Object.prototype.hasOwnProperty,Er=Object.prototype.propertyIsEnumerable;var ft=(o,e,t)=>e in o?Vt(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,h=(o,e)=>{for(var t in e||(e={}))Cr.call(e,t)&&ft(o,t,e[t]);if(Ut)for(var t of Ut(e))Er.call(e,t)&&ft(o,t,e[t]);return o},y=(o,e)=>vr(o,Br(e));var D=(o,e)=>{for(var t in e)Vt(o,t,{get:e[t],enumerable:!0})};var a=(o,e,t)=>(ft(o,typeof e!="symbol"?e+"":e,t),t);import Qt from"bignumber.js";var x={};D(x,{hexStringToObject:()=>Mr,hexStringToString:()=>$t,hexStringToUint8Array:()=>qt,numberToTokensAmount:()=>K,objectToHexString:()=>Or,stringToHexString:()=>Lt,toFixedBigNumber:()=>xt,tokensAmountToNat:()=>zr,uint8ArrayToHexString:()=>Ye});import Be from"bignumber.js";import{Buffer as W}from"buffer";var qt=o=>{var t;let e=(t=o.match(/[\da-f]{2}/gi))==null?void 0:t.map(r=>parseInt(r,16));return new Uint8Array(e)},Ye=o=>W.from(o).toString("hex"),Lt=o=>W.from(o,"utf8").toString("hex"),$t=o=>W.from(qt(o)).toString("utf8"),Or=o=>Lt(JSON.stringify(o)),Mr=o=>{try{return JSON.parse($t(o))}catch(e){return null}},zr=(o,e)=>new Be(o).multipliedBy(10**e).integerValue(),K=(o,e)=>new Be(o).integerValue().div(10**e),xt=(o,e,t)=>(o=Be.isBigNumber(o)?o:new Be(o),new Be(o.toFixed(e,t)));var de=class{constructor(e){this.options=e;a(this,"authorization");a(this,"exchangeManager");a(this,"swapManager");a(this,"wallets");a(this,"atomexContext");a(this,"_isStarted",!1);if(this.atomexContext=e.atomexContext,this.wallets=e.managers.walletsManager,this.authorization=e.managers.authorizationManager,this.exchangeManager=e.managers.exchangeManager,this.swapManager=e.managers.swapManager,e.blockchains)for(let t of Object.keys(e.blockchains))this.addBlockchain(r=>[t,e.blockchains[t]])}get atomexNetwork(){return this.atomexContext.atomexNetwork}get isStarted(){return this._isStarted}async start(){this.isStarted||(await this.authorization.start(),await this.exchangeManager.start(),await this.swapManager.start(),this._isStarted=!0)}stop(){!this.isStarted||(this.authorization.stop(),this.exchangeManager.stop(),this.swapManager.stop(),this._isStarted=!1)}addBlockchain(e){let[t,r]=e(this.atomexContext);this.atomexContext.providers.blockchainProvider.addBlockchain(t,r)}getCurrency(e){return this.atomexContext.providers.currenciesProvider.getCurrency(e)}async swap(e,t=15){if(typeof e=="number")throw new Error("Swap tracking is not implemented yet");let r=await this.exchangeManager.addOrder(e.accountAddress,e),n=await this.exchangeManager.getOrder(e.accountAddress,r);if(!n)throw new Error(`The ${r} order not found`);if(n.status!=="Filled")throw new Error(`The ${r} order is not filled`);let i=await Promise.all(n.swapIds.map(s=>this.swapManager.getSwap(s,e.accountAddress)));if(!i.length)throw new Error("Swaps not found");if(i.some(s=>!s))throw new Error("Swap not found");return i.length===1?i[0]:i}async convertCurrency(e,t,r){let n=await this.atomexContext.managers.priceManager.getAveragePrice({baseCurrency:t,quoteCurrency:r});if(!n)return;let s=(Qt.isBigNumber(e)?e:new Qt(e)).multipliedBy(n),c=this.getCurrency(r);return c?xt(s,c.decimals):s}};var wt=class{constructor(e){this.atomexNetwork=e;a(this,"id");a(this,"managers");a(this,"services");a(this,"providers");this.id=wt.idCounter++,this.managers=new bt(this),this.services=new Pt(this),this.providers=new kt(this)}},pe=wt;a(pe,"idCounter",0);var bt=class{constructor(e){this.context=e;a(this,"_walletsManager");a(this,"_authorizationManager");a(this,"_exchangeManager");a(this,"_swapManager");a(this,"_priceManager")}get walletsManager(){if(!this._walletsManager)throw new P("managers.walletsManager");return this._walletsManager}set walletsManager(e){this._walletsManager=e}get authorizationManager(){if(!this._authorizationManager)throw new P("managers.authorizationManager");return this._authorizationManager}set authorizationManager(e){this._authorizationManager=e}get exchangeManager(){if(!this._exchangeManager)throw new P("managers.exchangeManager");return this._exchangeManager}set exchangeManager(e){this._exchangeManager=e}get swapManager(){if(!this._swapManager)throw new P("managers.swapManager");return this._swapManager}set swapManager(e){this._swapManager=e}get priceManager(){if(!this._priceManager)throw new P("managers.priceManager");return this._priceManager}set priceManager(e){this._priceManager=e}},Pt=class{constructor(e){this.context=e;a(this,"_exchangeService");a(this,"_swapService")}get exchangeService(){if(!this._exchangeService)throw new P("services.exchangeService");return this._exchangeService}set exchangeService(e){this._exchangeService=e}get swapService(){if(!this._swapService)throw new P("services.swapService");return this._swapService}set swapService(e){this._swapService=e}},kt=class{constructor(e){this.context=e;a(this,"_blockchainProvider");a(this,"_currenciesProvider");a(this,"_exchangeSymbolsProvider");a(this,"_orderBookProvider")}get blockchainProvider(){if(!this._blockchainProvider)throw new P("providers.blockchainProvider");return this._blockchainProvider}set blockchainProvider(e){this._blockchainProvider=e}get currenciesProvider(){if(!this._currenciesProvider)throw new P("providers.currenciesProvider");return this._currenciesProvider}set currenciesProvider(e){this._currenciesProvider=e}get exchangeSymbolsProvider(){if(!this._exchangeSymbolsProvider)throw new P("providers.exchangeSymbolsProvider");return this._exchangeSymbolsProvider}set exchangeSymbolsProvider(e){this._exchangeSymbolsProvider=e}get orderBookProvider(){if(!this._orderBookProvider)throw new P("providers.orderBookProvider");return this._orderBookProvider}set orderBookProvider(e){this._orderBookProvider=e}},P=class extends Error{constructor(t){super(P.getMessage(t));a(this,"name");a(this,"componentName");this.componentName=t,this.name=this.constructor.name}static getMessage(t){return`Atomex "${t}" component has not resolved yet`}};var le={};D(le,{isArray:()=>Ir,isPlainObject:()=>Nr,isReadonlyArray:()=>_r});import Rr from"lodash.isplainobject";var Ir=o=>Array.isArray(o),_r=o=>Array.isArray(o),Nr=o=>Rr(o);var C={};D(C,{ensureNetworksAreSame:()=>Dr});var Dr=(o,e)=>{if((typeof o=="string"?o:o.atomexNetwork)!==(typeof e=="string"?e:e.atomexNetwork))throw new Error("Networks are different")};var Ce={};D(Ce,{capitalize:()=>Wr,padEnd:()=>Ur,padStart:()=>Fr});var Wr=o=>{var e;return o&&((e=o[0])==null?void 0:e.toLocaleUpperCase())+o.slice(1)},Ht=(o,e,t,r=" ")=>{if(String.prototype.padStart!==void 0)return o.padStart(t,r);let n=o.length;if(t<=n||r=="")return o;let i=t-n,s=r.repeat(Math.ceil(i/r.length));return s.length>i&&(s=s.slice(0,i)),e?s+o:o+s},Fr=(o,e,t=" ")=>String.prototype.padStart!==void 0?o.padStart(e,t):Ht(o,!0,e,t),Ur=(o,e,t=" ")=>String.prototype.padEnd!==void 0?o.padEnd(e,t):Ht(o,!1,e,t);var hn=o=>new Promise(e=>setTimeout(e,o)),St=o=>Math.min(o,2147483647);var ue=class{constructor(e){this.atomexNetwork=e;a(this,"wallets",new Set)}addWallet(e){return C.ensureNetworksAreSame(this,e),this.wallets.add(e),Promise.resolve(e)}async removeWallet(e){let t=this.wallets.delete(e);return Promise.resolve(t)}async getWallet(e,t,r){if(!this.wallets.size||!e&&!t&&!r)return;let n=[];for(let s of this.wallets){if(r&&s.id!==r)continue;let c=e?s.getAddress():void 0,m=t?s.getBlockchain():void 0;if((!e||e===c)&&(!t||t==m))return s;n.push(Promise.all([c,m]).then(([d,l])=>[s,d,l]))}let i=await Promise.allSettled(n);for(let s of i){if(s.status!=="fulfilled")continue;let[c,m,d]=s.value;if((!e||e===m)&&(!t||t==d))return c}}};var et=class{constructor(e,t){this.currency=e;this.getBalanceImplementation=t}getBalance(e){return this.getBalanceImplementation(e)}};var Ee=class{constructor(){a(this,"currencyInfoMap",new Map);a(this,"networkOptionsMap",new Map);a(this,"blockchainToolkitProviders",new Set)}addBlockchain(e,t){var r,n;if(this.networkOptionsMap.has(e))throw new Error("There is already blockchain added with the same key");this.networkOptionsMap.set(e,t),this.blockchainToolkitProviders.add(t.blockchainToolkitProvider);for(let i of t.currencies){if(this.currencyInfoMap.has(i.id))throw new Error("There is already currency added with the same key");let s=t.currencyOptions[i.id],c={currency:i,atomexProtocol:s==null?void 0:s.atomexProtocol,blockchainToolkitProvider:t.blockchainToolkitProvider,balanceProvider:(r=s==null?void 0:s.currencyBalanceProvider)!=null?r:this.createControlledBalancesProvider(i,t.balancesProvider),swapTransactionsProvider:(n=s==null?void 0:s.swapTransactionsProvider)!=null?n:t.swapTransactionsProvider};this.currencyInfoMap.set(i.id,c)}}getNetworkOptions(e){return this.networkOptionsMap.get(e)}getCurrency(e){var t;return(t=this.getCurrencyInfo(e))==null?void 0:t.currency}async getReadonlyToolkit(e,t){let r=[];for(let i of this.blockchainToolkitProviders)i.toolkitId===e&&r.push(i.getReadonlyToolkit(t));let n=await Promise.all(r);for(let i of n)if(i)return i;return Promise.resolve(void 0)}getCurrencyInfo(e){return this.currencyInfoMap.get(e)}createControlledBalancesProvider(e,t){return new et(e,r=>t.getBalance(r,e))}};import jt from"bignumber.js";var E={};D(E,{convertFromWei:()=>Lr,getGasPriceInWei:()=>qr});import Gt from"bignumber.js";var qr=async o=>{let e=await o.eth.getGasPrice();return new Gt(e)},Lr=(o,e,t)=>{let r=typeof e=="string"?e:e.toString(10),n=o.utils.fromWei(r,t);return new Gt(n)};var Oe=class{constructor(e,t,r,n,i){this.blockchain=e;this.atomexNetwork=t;this.atomexProtocolOptions=r;this.atomexBlockchainProvider=n;this.walletsManager=i;a(this,"version",1)}get currencyId(){return this.atomexProtocolOptions.currencyId}async getInitiateFees(e){var l;let t=await this.getReadonlyWeb3(),r=await E.getGasPriceInWei(t),n=this.atomexProtocolOptions.initiateOperation.gasLimit,i=(l=e.rewardForRedeem)==null?void 0:l.isGreaterThan(0),s=new jt(i?n.withReward:n.withoutReward),c=r.multipliedBy(s).multipliedBy(Oe.maxNetworkFeeMultiplier),m=E.convertFromWei(t,c,"ether"),d={estimated:m,max:m};return Promise.resolve(d)}async getRedeemFees(e){let t=await this.getReadonlyWeb3(),r=await E.getGasPriceInWei(t),n=this.atomexProtocolOptions.redeemOperation.gasLimit,i=r.multipliedBy(n).multipliedBy(Oe.maxNetworkFeeMultiplier),s=E.convertFromWei(t,i,"ether"),c={estimated:s,max:s};return Promise.resolve(c)}async getRefundFees(e){let t=await this.getReadonlyWeb3(),r=await E.getGasPriceInWei(t),n=this.atomexProtocolOptions.refundOperation.gasLimit,i=r.multipliedBy(n).multipliedBy(Oe.maxNetworkFeeMultiplier),s=E.convertFromWei(t,i,"ether"),c={estimated:s,max:s};return Promise.resolve(c)}async getReadonlyWeb3(){let e=await this.atomexBlockchainProvider.getReadonlyToolkit("web3",this.blockchain);if(!e)throw new Error("Web3 toolkit not found");return e}async getWallet(e){let t=await this.walletsManager.getWallet(e,this.blockchain,"web3");if(!t)throw new Error(`${this.blockchain} Web3 wallet not found`);return t}},z=Oe;a(z,"maxNetworkFeeMultiplier",new jt(1.2));import Hr from"web3";import{ec as $r}from"elliptic";var Tt=o=>o.blockchain==="ethereum";var At=null,Kr=()=>(At||(At=new $r("secp256k1")),At),Qr=o=>{let e=x.hexStringToUint8Array(o);if(e.length!==64&&e.length!==65)throw new Error(`Invalid signature: ${o}`);let t=e.length===64?27+(e[32]>>7):e[64];return(t===0||t===1)&&(t+=27),{r:Ye(e.slice(0,32)),s:Ye(e.slice(32,64)),v:t,recoveryParameter:1-t%2}},Zt=(o,e)=>{let t=Qr(o),r=W.from(e.startsWith("0x")?e.substring(2):e,"hex"),n=Kr().recoverPubKey(r,{r:t.r,s:t.s},t.recoveryParameter);return"0x"+n.encode("hex",!1)};var tt=class{constructor(e,t){this.atomexNetwork=e;this.provider=t;a(this,"id","web3");a(this,"toolkit");this.toolkit=new Hr(t)}async getBlockchain(){switch(await this.toolkit.eth.getChainId()){case 1:case 5:return"ethereum";case 56:case 97:return"binance"}return""}async getAddress(){let t=(await this.toolkit.eth.getAccounts())[0];if(!t)throw new Error("Address is unavailable");return t}getPublicKey(){}async sign(e){let t=await this.getAddress(),r=await this.signInternal(e,t),n=Zt(r,this.toolkit.eth.accounts.hashMessage(e));return{address:t,publicKeyBytes:n.startsWith("0x")?n.substring(2):n,signatureBytes:r.substring(r.startsWith("0x")?2:0,r.length-2),algorithm:tt.signingAlgorithm}}signInternal(e,t){return new Promise((r,n)=>this.toolkit.eth.personal.sign(e,t,"",(i,s)=>s?r(s):n(i)))}static async bind(e,t){let r=new tt(e.atomexNetwork,t);return await e.wallets.addWallet(r),r}},he=tt;a(he,"signingAlgorithm","Keccak256WithEcdsa:Geth2940");import Gr from"web3";var Q=class{constructor(e,t){this.blockchain=e;this.rpcUrl=t;a(this,"toolkitId","web3");a(this,"toolkit")}getReadonlyToolkit(e){return e&&e!==this.blockchain?Promise.resolve(void 0):(this.toolkit||(this.toolkit=new Gr(this.rpcUrl)),Promise.resolve(this.toolkit))}};import Xt from"bignumber.js";var vt=[{constant:!0,inputs:[],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_spender",type:"address"},{name:"_value",type:"uint256"}],name:"approve",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transferFrom",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"balance",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transfer",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"},{name:"_spender",type:"address"}],name:"allowance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{payable:!0,stateMutability:"payable",type:"fallback"},{anonymous:!1,inputs:[{indexed:!0,name:"owner",type:"address"},{indexed:!0,name:"spender",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Transfer",type:"event"}];var ye=class{constructor(e){this.blockchainProvider=e}async getBalance(e,t){if(!Tt(t))throw new Error("Not ethereum blockchain currency provided");let r=await this.blockchainProvider.getReadonlyToolkit("web3");if(!r)throw new Error("Readonly web3 toolkit not found");switch(t.type){case"native":return await this.getNativeTokenBalance(e,t,r);case"erc-20":return await this.getTokenBalance(e,t,r)}}async getNativeTokenBalance(e,t,r){let n=await r.eth.getBalance(e);return K(new Xt(n),t.decimals)}async getTokenBalance(e,t,r){let i=await new r.eth.Contract(vt,t.contractAddress).methods.balanceOf(e).call();return K(new Xt(i),t.decimals)}};var H=class extends z{constructor(t,r,n,i){super("ethereum",t,r,n,i);this.atomexProtocolOptions=r}initiate(t){throw new Error("Method not implemented.")}getInitiateFees(t){return super.getInitiateFees(t)}redeem(t){throw new Error("Method not implemented.")}getRedeemReward(t,r){throw new Error("Method not implemented.")}getRedeemFees(t){return super.getRedeemFees(t)}refund(t){throw new Error("Method not implemented.")}getRefundFees(t){return super.getRefundFees(t)}};var G=class extends z{constructor(t,r,n,i){super("ethereum",t,r,n,i);this.atomexProtocolOptions=r}get currencyId(){return this.atomexProtocolOptions.currencyId}initiate(t){throw new Error("Method not implemented.")}getInitiateFees(t){return super.getInitiateFees(t)}redeem(t){throw new Error("Method not implemented.")}getRedeemReward(t,r){throw new Error("Method not implemented.")}getRedeemFees(t){return super.getRedeemFees(t)}refund(t){throw new Error("Method not implemented.")}getRefundFees(t){return super.getRefundFees(t)}};var ge=class{constructor(){a(this,"_isStarted",!1)}get isStarted(){return this._isStarted}async start(){this.isStarted||(this._isStarted=!0)}stop(){!this.isStarted||(this._isStarted=!1)}getSwapTransactions(e){throw new Error("Method not implemented.")}};var Jt={id:"ETH",name:"Ethereum",symbol:"ETH",blockchain:"ethereum",decimals:18,type:"native"},Me=[Jt],ze=[Jt];var Yt=[{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"_hashedSecret",type:"bytes32"}],name:"Activated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"_hashedSecret",type:"bytes32"},{indexed:!1,internalType:"address",name:"_sender",type:"address"},{indexed:!1,internalType:"uint256",name:"_value",type:"uint256"}],name:"Added",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"_hashedSecret",type:"bytes32"},{indexed:!0,internalType:"address",name:"_participant",type:"address"},{indexed:!1,internalType:"address",name:"_initiator",type:"address"},{indexed:!1,internalType:"uint256",name:"_refundTimestamp",type:"uint256"},{indexed:!1,internalType:"uint256",name:"_countdown",type:"uint256"},{indexed:!1,internalType:"uint256",name:"_value",type:"uint256"},{indexed:!1,internalType:"uint256",name:"_payoff",type:"uint256"},{indexed:!1,internalType:"bool",name:"_active",type:"bool"}],name:"Initiated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"_hashedSecret",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"_secret",type:"bytes32"}],name:"Redeemed",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"_hashedSecret",type:"bytes32"}],name:"Refunded",type:"event"},{constant:!0,inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"swaps",outputs:[{internalType:"bytes32",name:"hashedSecret",type:"bytes32"},{internalType:"address payable",name:"initiator",type:"address"},{internalType:"address payable",name:"participant",type:"address"},{internalType:"uint256",name:"refundTimestamp",type:"uint256"},{internalType:"uint256",name:"countdown",type:"uint256"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"payoff",type:"uint256"},{internalType:"bool",name:"active",type:"bool"},{internalType:"enum Atomex.State",name:"state",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_hashedSecret",type:"bytes32"},{internalType:"address payable",name:"_participant",type:"address"},{internalType:"uint256",name:"_refundTimestamp",type:"uint256"},{internalType:"uint256",name:"_payoff",type:"uint256"}],name:"initiate",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_hashedSecret",type:"bytes32"}],name:"add",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_hashedSecret",type:"bytes32"}],name:"activate",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_hashedSecret",type:"bytes32"},{internalType:"bytes32",name:"_secret",type:"bytes32"}],name:"redeem",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_hashedSecret",type:"bytes32"}],name:"refund",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"}];var jr={atomexProtocolVersion:1,currencyId:"ETH",swapContractAddress:"0xe9c251cbb4881f9e056e40135e7d3ea9a7d037df",swapContractBlockId:"8168569",initiateOperation:{gasLimit:{withoutReward:2e5,withReward:21e4}},redeemOperation:{gasLimit:14e4},refundOperation:{gasLimit:9e4},defaultGasPriceInGwei:90,maxGasPriceInGwei:650,abi:Yt},fe={ETH:jr};var Zr=y(h({},fe.ETH),{swapContractAddress:"0x512fe6B803bA327DCeFBF2Cec7De333f761B0f2b",swapContractBlockId:"6954501"}),rt={ETH:Zr};var Xr=(o,e,t)=>{switch(e.type){case"native":return new H(o.atomexNetwork,t,o.providers.blockchainProvider,o.managers.walletsManager);case"erc-20":return new G(o.atomexNetwork,t,o.providers.blockchainProvider,o.managers.walletsManager);default:throw new Error(`Unknown Ethereum currency: ${e.id}`)}},er=(o,e,t)=>{let r={},n=e.reduce((i,s)=>(i[s.id]=s,i),{});for(let i of Object.values(t)){let s=n[i.currencyId];if(!s)throw new Error(`The ${i.currencyId} currency not found`);r[s.id]={atomexProtocol:Xr(o,s,i)}}return r},ot=o=>{let e="ethereum",t="https://mainnet.infura.io/v3/df01d4ef450640a2a48d9af4c2078eaf",r="https://goerli.infura.io/v3/df01d4ef450640a2a48d9af4c2078eaf",n=new ye(o.providers.blockchainProvider),i=new ge;return o.atomexNetwork==="mainnet"?{rpcUrl:t,currencies:Me,currencyOptions:er(o,Me,fe),blockchainToolkitProvider:new Q(e,t),balancesProvider:n,swapTransactionsProvider:i}:{rpcUrl:r,currencies:ze,currencyOptions:er(o,ze,rt),blockchainToolkitProvider:new Q(e,r),balancesProvider:n,swapTransactionsProvider:i}};var g={};D(g,{convertSymbolToFromToCurrenciesPair:()=>Jr,findExchangeSymbolAndSide:()=>Yr,getQuoteBaseCurrenciesBySymbol:()=>tr});import R from"bignumber.js";var tr=o=>{let[e="",t=""]=o.split("/");return[e,t]},Jr=(o,e,t,r,n=!0)=>{let i=x.toFixedBigNumber(r,o.decimals.price,R.ROUND_FLOOR),[s,c]=tr(o.name),m=e==="Buy",d,l;n?(d=x.toFixedBigNumber(t,o.decimals.quoteCurrency,R.ROUND_FLOOR),l=x.toFixedBigNumber(i.multipliedBy(d),o.decimals.baseCurrency,m?R.ROUND_CEIL:R.ROUND_FLOOR)):(l=x.toFixedBigNumber(t,o.decimals.baseCurrency,R.ROUND_FLOOR),d=x.toFixedBigNumber(l.div(i),o.decimals.quoteCurrency,m?R.ROUND_FLOOR:R.ROUND_CEIL));let b=x.toFixedBigNumber(new R(1).div(i),o.decimals.price,R.ROUND_FLOOR),k={currencyId:s,amount:d,price:i},w={currencyId:c,amount:l,price:b};return m?[w,k]:[k,w]},Yr=(o,e,t)=>{let r=`${e}/${t}`,n=`${t}/${e}`,i,s="Sell";if(le.isReadonlyArray(o))for(let c of o){if(c.name===r){i=c;break}if(c.name===n){i=c,s="Buy";break}}else i=o.get(r),i||(s="Buy",i=o.get(n));if(!i)throw new Error(`Invalid pair: ${e}/${t}`);return[i,s]};import{nanoid as eo}from"nanoid";var Re=(r=>(r[r.Local=1]="Local",r[r.Remote=2]="Remote",r[r.All=3]="All",r))(Re||{});var Ie=(r=>(r[r.Local=0]="Local",r[r.Remote=1]="Remote",r[r.SafeMerged=2]="SafeMerged",r))(Ie||{});var u=class{constructor(){a(this,"listeners",new Set)}addListener(e){return this.listeners.add(e),this}removeListener(e){return this.listeners.has(e)&&this.listeners.delete(e),this}removeAllListeners(){return this.listeners=new Set,this}emit(...e){!this.listeners.size||(this.listeners.size===1?this.listeners.values().next().value(...e):[...this.listeners].forEach(t=>t(...e)))}};var _e=class{constructor(e=1e3){this.latencyMs=e;a(this,"watcherIdsMap",new Map);a(this,"internalEmitter",new u)}addListener(e){return this.internalEmitter.addListener(e),this}removeListener(e){return this.internalEmitter.removeListener(e),this}removeAllListeners(){return this.internalEmitter.removeAllListeners(),this}emit(e,...t){let r=this.watcherIdsMap.get(e);r&&clearTimeout(r);let n=setTimeout(()=>{this.watcherIdsMap.delete(e),this.internalEmitter.emit(...t)},this.latencyMs);this.watcherIdsMap.set(e,n)}};var v=class{constructor(e){this.baseUrl=e}async request(e,t=!0){let r=new URL(e.urlPath,this.baseUrl);e.params&&this.setSearchParams(r,e.params);let n=await fetch(r.toString(),{headers:this.createHeaders(e),method:e.method||"GET",body:e.payload?JSON.stringify(e.payload):void 0});if(!(t&&n.status===404)){if(!n.ok){let i=await n.text();throw Error(i)}return await n.json()}}setSearchParams(e,t){for(let r in t){let n=t[r];n!=null&&e.searchParams.set(r,String(n))}}createHeaders(e){let t={};return e.authToken&&(t.Authorization=`Bearer ${e.authToken}`),e.method==="POST"&&e.payload&&(t["Content-Type"]="application/json"),t}};var xe=class{constructor(e){a(this,"events",{orderUpdated:new u,orderBookSnapshot:new u,orderBookUpdated:new u,topOfBookUpdated:new u});a(this,"exchangeService");a(this,"symbolsProvider");a(this,"orderBookProvider");a(this,"_isStarted",!1);a(this,"handleExchangeServiceOrderUpdated",e=>{this.events.orderUpdated.emit(e)});a(this,"handleExchangeServiceOrderBookSnapshot",async e=>{this.events.orderBookSnapshot.emit(e)});a(this,"handleExchangeServiceOrderBookUpdated",async e=>{this.events.orderBookUpdated.emit(e)});a(this,"handleExchangeServiceTopOfBookUpdated",e=>{this.events.topOfBookUpdated.emit(e)});this.exchangeService=e.exchangeService,this.symbolsProvider=e.symbolsProvider,this.orderBookProvider=e.orderBookProvider}get isStarted(){return this._isStarted}async start(){this.isStarted||(this.attachEvents(),await this.exchangeService.start(),await this.getSymbols(),this._isStarted=!0)}stop(){!this._isStarted||(this.detachEvents(),this.exchangeService.stop(),this._isStarted=!1)}getOrder(e,t,r=2){return this.exchangeService.getOrder(e,t)}getOrders(e,t,r=2){return this.exchangeService.getOrders(e,t)}async getSymbol(e,t=3){if((t&1)===1){let r=this.symbolsProvider.getSymbol(e);if(r)return r}if((t&2)===2){let r=await this.exchangeService.getSymbols();return this.symbolsProvider.setSymbols(r),this.symbolsProvider.getSymbol(e)}}async getSymbols(e=3){if((e&1)===1){let t=this.symbolsProvider.getSymbols();if(t.length>0)return t}if((e&2)===2){let t=await this.exchangeService.getSymbols();return this.symbolsProvider.setSymbols(t),t}return[]}getTopOfBook(e){return this.exchangeService.getTopOfBook(e)}async getOrderBook(e){let t;if(typeof e=="string")t=e;else{let n=this.symbolsProvider.getSymbolsMap();t=g.findExchangeSymbolAndSide(n,e.from,e.to)[0].name}if(!t)throw new Error("Invalid Symbol");let r=await this.exchangeService.getOrderBook(t);return r&&this.orderBookProvider.setOrderBook(t,r),r}addOrder(e,t){let r=t.clientOrderId||eo(17);return this.exchangeService.addOrder(e,y(h({},t),{clientOrderId:r}))}cancelOrder(e,t){return this.exchangeService.cancelOrder(e,t)}cancelAllOrders(e,t){return this.exchangeService.cancelAllOrders(e,t)}async getOrderPreview(e){if(e.type!=="SolidFillOrKill")throw new Error('Only the "SolidFillOrKill" order type is supported at the current moment');let t=this.getPreparedOrderPreviewParameters(e),r=await this.findOrderBookEntry(t.exchangeSymbol.name,t.side,e.type,t.amount,t.isQuoteCurrencyAmount);if(!r)return;let[n,i]=g.convertSymbolToFromToCurrenciesPair(t.exchangeSymbol,t.side,t.amount,r.price,t.isQuoteCurrencyAmount);return{type:e.type,from:n,to:i,side:t.side,symbol:t.exchangeSymbol.name}}getMaximumLiquidity(e){throw new Error("Not implemented")}attachEvents(){this.exchangeService.events.orderUpdated.addListener(this.handleExchangeServiceOrderUpdated),this.exchangeService.events.orderBookSnapshot.addListener(this.handleExchangeServiceOrderBookSnapshot),this.exchangeService.events.orderBookUpdated.addListener(this.handleExchangeServiceOrderBookUpdated),this.exchangeService.events.topOfBookUpdated.addListener(this.handleExchangeServiceTopOfBookUpdated)}detachEvents(){this.exchangeService.events.orderUpdated.removeListener(this.handleExchangeServiceOrderUpdated),this.exchangeService.events.orderBookSnapshot.removeListener(this.handleExchangeServiceOrderBookSnapshot),this.exchangeService.events.orderBookUpdated.removeListener(this.handleExchangeServiceOrderBookUpdated),this.exchangeService.events.topOfBookUpdated.removeListener(this.handleExchangeServiceTopOfBookUpdated)}getPreparedOrderPreviewParameters(e){let t=this.symbolsProvider.getSymbolsMap(),r,n,i,s=!0;if(e.symbol&&e.side)r=e.symbol,n=t.get(r),i=e.side,e.isQuoteCurrencyAmount!==void 0&&e.isQuoteCurrencyAmount!==null&&(s=e.isQuoteCurrencyAmount);else if(e.from&&e.to){[n,i]=g.findExchangeSymbolAndSide(t,e.from,e.to),r=n.name;let c=e.isFromAmount!==void 0&&e.isFromAmount!==null?e.isFromAmount:!0;n&&(s=e.from===n.quoteCurrency&&c||e.to===n.quoteCurrency&&!c)}else throw new Error("Invalid orderPreviewParameters argument passed");if(!n)throw new Error(`The ${r} Symbol not found`);return{type:e.type,amount:e.amount,exchangeSymbol:n,side:i,isQuoteCurrencyAmount:s}}async findOrderBookEntry(e,t,r,n,i){if(r!=="SolidFillOrKill")return;let s=await this.getCachedOrderBook(e);if(!!s){for(let c of s.entries)if(c.side!==t&&(i?n:n.div(c.price)).isLessThanOrEqualTo(Math.max(...c.qtyProfile)))return c}}getCachedOrderBook(e){let t=this.orderBookProvider.getOrderBook(e);return t?Promise.resolve(t):this.getOrderBook(e)}};var j=class{constructor(){a(this,"symbolsMap",new Map);a(this,"symbolsCollectionCache",[])}getSymbol(e){return this.symbolsMap.get(e)}getSymbols(){return this.symbolsCollectionCache}getSymbolsMap(){return this.symbolsMap}setSymbols(e){this.symbolsCollectionCache=e,this.symbolsMap=this.mapSymbolsCollectionToMap(e)}mapSymbolsCollectionToMap(e){let t=new Map;for(let r of e)t.set(r.name,r);return t}};var be=class{constructor(){a(this,"orderBookMap",new Map)}getOrderBook(e){return this.orderBookMap.get(e)}setOrderBook(e,t){this.orderBookMap.set(e,t)}};import to from"bignumber.js";var Z=class{constructor(e){this.providersMap=e}async getAveragePrice({baseCurrency:e,quoteCurrency:t,dataSource:r=3}){let i=this.getAvailableProviders().map(m=>this.getPrice({baseCurrency:e,quoteCurrency:t,provider:m})),s=await Promise.allSettled(i),c=[];for(let m of s)m.status==="fulfilled"&&m.value!==void 0&&c.push(m.value);return c.length?to.sum(...c).div(c.length):void 0}async getPrice({baseCurrency:e,quoteCurrency:t,provider:r,dataSource:n=3}){let i=await this.getPriceCore(e,t,r);if(!i){let s=await this.getPriceCore(t,e,r);s&&(i=s.pow(-1))}return i}getAvailableProviders(){return[...this.providersMap.keys()]}dispose(){throw new Error("Method not implemented.")}async getPriceCore(e,t,r){let i=this.getSelectedProviders(r).map(c=>c.getPrice(e,t)),s=await Promise.allSettled(i);for(let c of s)if(c.status==="fulfilled"&&c.value!==void 0)return c.value}getSelectedProviders(e){if(!e)return[...this.providersMap.values()];let t=this.providersMap.get(e);if(!t)throw new Error(`Provider not found for key: ${e}`);return[t]}};var X=class{constructor(e){this.exchangeService=e}async getPrice(e,t){var i;let r=`${e}/${t}`,n=(i=await this.exchangeService.getTopOfBook([{from:e,to:t}]))==null?void 0:i[0];return n&&n.symbol==r?this.getMiddlePrice(n):void 0}getMiddlePrice(e){return e.ask.plus(e.bid).div(2)}};import ro from"bignumber.js";var rr=o=>{let e=o;return typeof e.code=="number"&&typeof e.msg=="string"};var Ne=class{constructor(){a(this,"httpClient");a(this,"_allSymbols");this.httpClient=new v(Ne.baseUrl)}async getPrice(e,t){let r=`${e}${t}`;if(!(await this.getAllSymbols()).has(r))return;let i=`${Ne.priceUrlPath}?symbol=${r}`,s=await this.httpClient.request({urlPath:i},!1);return this.mapRatesDtoToPrice(s)}mapRatesDtoToPrice(e){if(!rr(e))return new ro(e.price)}async getAllSymbols(){return this._allSymbols||(this._allSymbols=new Set(await this.requestAllSymbols())),this._allSymbols}async requestAllSymbols(){let e=Ne.priceUrlPath;return(await this.httpClient.request({urlPath:e},!1)).map(r=>r.symbol)}},I=Ne;a(I,"baseUrl","https://www.binance.com"),a(I,"priceUrlPath","/api/v3/ticker/price");import oo from"bignumber.js";var Bt=class{constructor(){a(this,"httpClient");this.httpClient=new v(Bt.baseUrl)}async getPrice(e,t){let n=`/0/public/Ticker?pair=${`${e}${t}`}`,i=await this.httpClient.request({urlPath:n},!1);return this.mapRatesDtoToPrice(i)}mapRatesDtoToPrice(e){if(e.error.length)return;let t=Object.keys(e.result)[0],r=t?e.result[t]:void 0;if(!!r)return new oo(r.c[0])}},F=Bt;a(F,"baseUrl","https://api.kraken.com");var nt=class{constructor(e){this.swapService=e;a(this,"events",{swapUpdated:new u});a(this,"_isStarted",!1);a(this,"handleSwapServiceSwapUpdated",e=>{this.events.swapUpdated.emit(e)})}get isStarted(){return this._isStarted}async start(){this.isStarted||(this.attachEvents(),await this.swapService.start(),this._isStarted=!0)}stop(){!this.isStarted||(this.detachEvents(),this.swapService.stop(),this._isStarted=!1)}getSwap(e,t,r=2){return this.swapService.getSwap(e,t)}getSwaps(e,t,r=2){return this.swapService.getSwaps(e,t)}attachEvents(){this.swapService.events.swapUpdated.addListener(this.handleSwapServiceSwapUpdated)}detachEvents(){this.swapService.events.swapUpdated.removeListener(this.handleSwapServiceSwapUpdated)}};import{SigningType as go}from"@airgap/beacon-sdk";import{TezosToolkit as fo}from"@taquito/taquito";import{b58cdecode as lo,prefix as uo,validatePkAndExtractPrefix as ho}from"@taquito/utils";import yo from"bignumber.js";var Ct=o=>o.blockchain==="tezos";var T={};D(T,{decodeSignature:()=>De,getRawMichelineSigningData:()=>co,getRawSigningData:()=>so,getTezosSigningAlgorithm:()=>po,getWalletMichelineSigningData:()=>mo});import{b58cdecode as no,prefix as io,Prefix as Pe}from"@taquito/utils";var ao="54657a6f73205369676e6564204d6573736167653a20",nr=(o,e)=>{let t=x.stringToHexString(o),r=e?e+t:t,n=Ce.padStart((r.length/2).toString(16),8,"0");return"0501"+n+r},so=o=>x.stringToHexString(o),co=o=>nr(o),mo=o=>nr(o,ao),po=o=>{let e=o.substring(0,o.startsWith("tz")?3:4);switch(e){case Pe.TZ1:case Pe.EDPK:return"Ed25519:Blake2b";case Pe.TZ2:case Pe.SPPK:return"Blake2bWithEcdsa:Secp256k1";case Pe.TZ3:case Pe.P2PK:return"Blake2bWithEcdsa:Secp256r1";default:throw new Error(`Unexpected address/public key prefix: ${e} (${o})`)}},De=o=>{let e=o.startsWith("sig")?o.substring(0,3):o.substring(0,5),t=no(o,io[e]);return Buffer.from(t).toString("hex")};var it=new yo(1e6),ke=o=>{let e=ho(o),t=lo(o,uo[e]);return W.from(t).toString("hex")};var at=class{constructor(e,t,r){this.atomexNetwork=e;this.beaconWallet=t;a(this,"id","taquito");a(this,"toolkit");this.toolkit=new fo(r),this.toolkit.setWalletProvider(t)}getBlockchain(){return"tezos"}getAddress(){return this.beaconWallet.getPKH()}async getPublicKey(){var e;return(e=await this.beaconWallet.client.getActiveAccount())==null?void 0:e.publicKey}async sign(e){let[t,r,n]=await Promise.all([this.getAddress(),this.getPublicKey(),this.beaconWallet.client.requestSignPayload({payload:T.getWalletMichelineSigningData(e),signingType:go.MICHELINE})]);if(!r)throw new Error("BeaconWallet: public key is unavailable");let i=T.getTezosSigningAlgorithm(r),s=ke(r),c=De(n.signature);return{address:t,algorithm:i,publicKeyBytes:s,signatureBytes:c,signingDataType:"tezos/wallet-micheline"}}};import{InMemorySigner as xo}from"@taquito/signer";import{TezosToolkit as bo}from"@taquito/taquito";var st=class{constructor(e,t,r){this.atomexNetwork=e;a(this,"id","taquito");a(this,"toolkit");a(this,"internalInMemorySigner");this.internalInMemorySigner=new xo(t),this.toolkit=new bo(r),this.toolkit.setSignerProvider(this.internalInMemorySigner)}getBlockchain(){return"tezos"}getAddress(){return this.internalInMemorySigner.publicKeyHash()}getPublicKey(){return this.internalInMemorySigner.publicKey()}async sign(e){let t=T.getRawSigningData(e),[r,n,i]=await Promise.all([this.getAddress(),this.getPublicKey(),this.internalInMemorySigner.sign(t)]),s=ke(n),c=i.sbytes.substring(i.bytes.length),m=T.getTezosSigningAlgorithm(n);return{address:r,algorithm:m,publicKeyBytes:s,signatureBytes:c}}};import{TezosToolkit as Po}from"@taquito/taquito";var ct=class{constructor(e,t,r){this.atomexNetwork=e;this.templeWallet=t;a(this,"id","taquito");a(this,"blockchain","tezos");a(this,"toolkit");this.toolkit=new Po(r),this.toolkit.setWalletProvider(t)}getBlockchain(){return"tezos"}getAddress(){return this.templeWallet.getPKH()}getPublicKey(){var e;return(e=this.templeWallet.permission)==null?void 0:e.publicKey}async sign(e){let[t,r,n]=await Promise.all([this.getAddress(),this.getPublicKey(),this.templeWallet.sign(T.getWalletMichelineSigningData(e))]);if(!r)throw new Error("TempleWallet: public key is unavailable");let i=T.getTezosSigningAlgorithm(r),s=ke(r),c=De(n);return{address:t,algorithm:i,publicKeyBytes:s,signatureBytes:c,signingDataType:"tezos/wallet-micheline"}}};var J=class{constructor(e,t,r){this.atomexNetwork=e;this.walletOrSecretKey=t;this.rpcUrl=r;a(this,"internalWallet");this.internalWallet=this.createInternalWallet(t)}get id(){return this.internalWallet.id}get toolkit(){return this.internalWallet.toolkit}getAddress(){return this.internalWallet.getAddress()}getPublicKey(){return this.internalWallet.getPublicKey()}getBlockchain(){return this.internalWallet.getBlockchain()}sign(e){return this.internalWallet.sign(e)}createInternalWallet(e){var t;if(typeof e=="string")return new st(this.atomexNetwork,e,this.rpcUrl);if(((t=e.client)==null?void 0:t.name)!==void 0)return new at(this.atomexNetwork,e,this.rpcUrl);if(e.permission!==void 0&&e.connected!==void 0)return new ct(this.atomexNetwork,e,this.rpcUrl);throw new Error("Unknown Tezos wallet")}static async bind(e,t){var s;let r="tezos",n=(s=e.atomexContext.providers.blockchainProvider.getNetworkOptions(r))==null?void 0:s.rpcUrl;if(!n)throw new Error(`There is not rpc url for ${r} network`);let i=new J(e.atomexNetwork,t,n);return await e.wallets.addWallet(i),i}};import Et from"bignumber.js";var U=class{constructor(e,t,r,n,i){this.blockchain=e;this.atomexNetwork=t;this.atomexProtocolOptions=r;this.atomexBlockchainProvider=n;this.walletsManager=i;a(this,"version",1)}get currencyId(){return this.atomexProtocolOptions.currencyId}getInitiateFees(e){let t=new Et(this.atomexProtocolOptions.initiateOperation.fee).div(it),r={estimated:t,max:t};return Promise.resolve(r)}getRedeemFees(e){let t=new Et(this.atomexProtocolOptions.redeemOperation.fee).div(it),r={estimated:t,max:t};return Promise.resolve(r)}getRefundFees(e){let t=new Et(this.atomexProtocolOptions.refundOperation.fee).div(it),r={estimated:t,max:t};return Promise.resolve(r)}async getReadonlyTezosToolkit(){let e=await this.atomexBlockchainProvider.getReadonlyToolkit("taquito",this.blockchain);if(!e)throw new Error("Tezos toolkit not found");return e}async getWallet(e){let t=await this.walletsManager.getWallet(e,this.blockchain,"taquito");if(!t)throw new Error(`${this.blockchain} Taqutio wallet not found`);return t}};var Y=class extends U{constructor(t,r,n,i){super("tezos",t,r,n,i);this.atomexProtocolOptions=r}get currencyId(){return this.atomexProtocolOptions.currencyId}initiate(t){throw new Error("Method not implemented.")}getInitiateFees(t){return super.getInitiateFees(t)}redeem(t){throw new Error("Method not implemented.")}getRedeemReward(t,r){throw new Error("Method not implemented.")}getRedeemFees(t){return super.getRedeemFees(t)}refund(t){throw new Error("Method not implemented.")}getRefundFees(t){return super.getRefundFees(t)}};var ee=class extends U{constructor(t,r,n,i){super("tezos",t,r,n,i);this.atomexProtocolOptions=r}get currencyId(){return this.atomexProtocolOptions.currencyId}initiate(t){throw new Error("Method not implemented.")}getInitiateFees(t){return super.getInitiateFees(t)}redeem(t){throw new Error("Method not implemented.")}getRedeemReward(t,r){throw new Error("Method not implemented.")}getRedeemFees(t){return super.getRedeemFees(t)}refund(t){throw new Error("Method not implemented.")}getRefundFees(t){return super.getRefundFees(t)}};var te=class extends U{constructor(t,r,n,i){super("tezos",t,r,n,i);this.atomexProtocolOptions=r}get currencyId(){return this.atomexProtocolOptions.currencyId}initiate(t){throw new Error("Method not implemented.")}getInitiateFees(t){return super.getInitiateFees(t)}redeem(t){throw new Error("Method not implemented.")}getRedeemReward(t,r){throw new Error("Method not implemented.")}getRedeemFees(t){return super.getRedeemFees(t)}refund(t){throw new Error("Method not implemented.")}getRefundFees(t){return super.getRefundFees(t)}};var re=class{constructor(e){a(this,"httpClient");this.httpClient=new v(e)}async getBalance(e,t){if(!Ct(t))throw new Error("Not tezos blockchain currency provided");switch(t.type){case"native":return await this.getNativeTokenBalance(e,t);case"fa1.2":case"fa2":return await this.getTokenBalance(e,t)}}async getNativeTokenBalance(e,t){let r=`/v1/accounts/${e}/balance`,n=await this.httpClient.request({urlPath:r},!1);return K(n,t.decimals)}async getTokenBalance(e,t){let r="/v1/tokens/balances",n={account:e,"token.contract":t.contractAddress,"token.tokenId":t.type==="fa1.2"?0:t.tokenId,select:"balance"},s=(await this.httpClient.request({urlPath:r,params:n},!1))[0];if(s===void 0)throw new Error("Invalid response");return K(s,t.decimals)}};var we=class{constructor(){a(this,"_isStarted",!1)}get isStarted(){return this._isStarted}async start(){this.isStarted||(this._isStarted=!0)}stop(){!this.isStarted||(this._isStarted=!1)}getSwapTransactions(e){throw new Error("Method not implemented.")}};import{TezosToolkit as ko}from"@taquito/taquito";var Ot=class{constructor(e){this.rpcUrl=e;a(this,"toolkitId","taquito");a(this,"toolkit")}getReadonlyToolkit(e){return e&&e!==Ot.BLOCKCHAIN?Promise.resolve(void 0):(this.toolkit||(this.toolkit=new ko(this.rpcUrl)),Promise.resolve(this.toolkit))}},V=Ot;a(V,"BLOCKCHAIN","tezos");var ir={id:"XTZ",name:"Tezos",symbol:"XTZ",blockchain:"tezos",decimals:6,type:"native"},ar={id:"TZBTC",name:"tzBTC",symbol:"tzBTC",blockchain:"tezos",type:"fa1.2",contractAddress:"KT1PWx2mnDueood7fEmfbBDKx1D9BAnnXitn",decimals:8},wo={id:"KUSD",name:"Kolibri USD",symbol:"kUSD",blockchain:"tezos",type:"fa1.2",contractAddress:"KT1K9gCRgaLRFKTErYt1wVxA3Frb9FjasjTV",decimals:18},sr={id:"USDT_XTZ",name:"Tether USD",symbol:"USDt",blockchain:"tezos",type:"fa2",tokenId:0,contractAddress:"KT1XnTn74bUtxHfDtBmm2bGZAQfhPbvKWR8o",decimals:6},We=[ir,ar,wo,sr],Fe=[ir,y(h({},ar),{contractAddress:"KT1DM4k79uSx5diQnwqDiF4XeA86aCBxBD35"}),y(h({},sr),{contractAddress:"KT1BWvRQnVVowZZLGkct9A7sdj5YEe8CdUhR"})];var Ue={atomexProtocolVersion:1,initiateOperation:{fee:11e3,gasLimit:11e4,storageLimit:350},redeemOperation:{fee:11e3,gasLimit:15e3,storageLimit:257},refundOperation:{fee:11e3,gasLimit:11e4,storageLimit:257}},cr={atomexProtocolVersion:1,initiateOperation:{fee:35e4,gasLimit:4e5,storageLimit:250},redeemOperation:{fee:12e4,gasLimit:4e5,storageLimit:257},refundOperation:{fee:12e4,gasLimit:4e5,storageLimit:257}};var mr={atomexProtocolVersion:1,initiateOperation:{fee:35e4,gasLimit:4e5,storageLimit:250},redeemOperation:{fee:12e4,gasLimit:4e5,storageLimit:257},refundOperation:{fee:12e4,gasLimit:4e5,storageLimit:257}};var So={atomexProtocolVersion:1,currencyId:"XTZ",swapContractAddress:"KT1VG2WtYdSWz5E7chTeAdDPZNy2MpP8pTfL",swapContractBlockId:"513046",initiateOperation:{fee:2e3,gasLimit:11e3,storageLimit:257},redeemOperation:{fee:2e3,gasLimit:15e3,storageLimit:257},refundOperation:{fee:1600,gasLimit:13e3,storageLimit:257}},To=y(h({},Ue),{currencyId:"TZBTC",swapContractAddress:"KT1Ap287P1NzsnToSJdA4aqSNjPomRaHBZSr",swapContractBlockId:"900350",redeemOperation:y(h({},Ue.redeemOperation),{gasLimit:18e4})}),Ao=y(h({},Ue),{currencyId:"KUSD",swapContractAddress:"KT1EpQVwqLGSH7vMCWKJnq6Uxi851sEDbhWL",swapContractBlockId:"1358868",redeemOperation:y(h({},Ue.redeemOperation),{gasLimit:11e4})}),vo=y(h({},cr),{currencyId:"USDT_XTZ",swapContractAddress:"KT1Ays1Chwx3ArnHGoQXchUgDsvKe9JboUjj",swapContractBlockId:"2496680"}),mt={XTZ:So,TZBTC:To,KUSD:Ao,USDT_XTZ:vo};var Bo={atomexProtocolVersion:1,currencyId:"XTZ",swapContractAddress:"KT1VG2WtYdSWz5E7chTeAdDPZNy2MpP8pTfL",swapContractBlockId:"513046",initiateOperation:{fee:2e3,gasLimit:11e3,storageLimit:257},redeemOperation:{fee:2e3,gasLimit:15e3,storageLimit:257},refundOperation:{fee:1600,gasLimit:13e3,storageLimit:257}},Co=y(h({},mr),{currencyId:"USDT_XTZ",swapContractAddress:"KT1BWvRQnVVowZZLGkct9A7sdj5YEe8CdUhR",swapContractBlockId:"665321"}),Mt={XTZ:Bo,USDT_XTZ:Co};var Eo=(o,e,t)=>{switch(e.type){case"native":return new Y(o.atomexNetwork,t,o.providers.blockchainProvider,o.managers.walletsManager);case"fa1.2":return new ee(o.atomexNetwork,t,o.providers.blockchainProvider,o.managers.walletsManager);case"fa2":return new te(o.atomexNetwork,t,o.providers.blockchainProvider,o.managers.walletsManager);default:throw new Error(`Unknown Tezos currency: ${e.id}`)}},dr=(o,e,t)=>{let r={},n=e.reduce((i,s)=>(i[s.id]=s,i),{});for(let i of Object.values(t)){let s=n[i.currencyId];if(!s)throw new Error(`The ${i.currencyId} currency not found`);r[s.id]={atomexProtocol:Eo(o,s,i)}}return r},dt=o=>{let e="https://rpc.tzkt.io/mainnet/",t="https://rpc.tzkt.io/ithacanet/",r=new we;return o.atomexNetwork==="mainnet"?{rpcUrl:e,currencies:We,currencyOptions:dr(o,We,mt),blockchainToolkitProvider:new V(e),balancesProvider:new re("https://api.mainnet.tzkt.io/"),swapTransactionsProvider:r}:{rpcUrl:t,currencies:Fe,currencyOptions:dr(o,Fe,Mt),blockchainToolkitProvider:new V(t),balancesProvider:new re("https://api.ghostnet.tzkt.io/"),swapTransactionsProvider:r}};import A from"bignumber.js";var ur=o=>typeof o.symbol=="string"&&typeof o.side=="string"&&!!o.from&&!!o.to,pt=o=>o.map(t=>Oo(t)),Oo=o=>{let[e,t]=g.getQuoteBaseCurrenciesBySymbol(o.symbol);return{ask:new A(o.ask),bid:new A(o.bid),symbol:o.symbol,timeStamp:new Date(o.timeStamp),quoteCurrency:e,baseCurrency:t}},Mo=(o,e,t=9)=>{var d,l;let[r,n]=g.getQuoteBaseCurrenciesBySymbol(o.name),i=(d=e.getCurrency(n))==null?void 0:d.decimals,s=(l=e.getCurrency(r))==null?void 0:l.decimals,c=i?Math.min(i,t):t,m=s?Math.min(s,t):t;return{name:o.name,baseCurrency:n,quoteCurrency:r,minimumQty:new A(o.minimumQty),decimals:{baseCurrency:c,quoteCurrency:m,price:t}}},hr=(o,e,t)=>o.map(r=>Mo(r,e,t)),lt=o=>{let[e,t]=g.getQuoteBaseCurrenciesBySymbol(o.symbol);return{updateId:o.updateId,symbol:o.symbol,quoteCurrency:e,baseCurrency:t,entries:o.entries.map(n=>yr(n))}},yr=o=>({side:o.side,price:new A(o.price),qtyProfile:o.qtyProfile}),gr=(o,e)=>{let t=new Map;for(let r of o){let n=t.get(r.symbol)||e.getOrderBook(r.symbol);if(!n)continue;let i=yr(r),s=n.entries.find(d=>d.side===i.side&&d.price.isEqualTo(i.price)),c=r.qtyProfile.length?s?n.entries.map(d=>d===s?y(h({},d),{qtyProfile:i.qtyProfile}):d):[...n.entries,i]:n.entries.filter(d=>d!==s),m=y(h({},n),{updateId:r.updateId,entries:c});t.set(m.symbol,m)}return Array.from(t.values())},zt=(o,e)=>{var i;let t=e.getSymbol(o.symbol);if(!t)throw new Error(`"${o.symbol}" symbol not found`);let[r,n]=g.convertSymbolToFromToCurrenciesPair(t,o.side,o.qty,o.price);return{id:o.id,from:r,to:n,clientOrderId:o.clientOrderId,side:o.side,symbol:o.symbol,leaveQty:new A(o.leaveQty),timeStamp:new Date(o.timeStamp),type:o.type,status:o.status,swapIds:((i=o.swaps)==null?void 0:i.map(s=>s.id))||[]}},fr=(o,e)=>o.map(t=>zt(t,e)),pr=o=>o.map(t=>({id:t.txId,blockId:t.blockHeight,confirmations:t.confirmations,currencyId:t.currency,status:t.status,type:t.type})),Ve=(o,e)=>{let t=e.getSymbol(o.symbol);if(!t)throw new Error(`"${o.symbol}" symbol not found`);let[r,n]=g.convertSymbolToFromToCurrenciesPair(t,o.side,o.qty,o.price);return{isInitiator:o.isInitiator,secret:o.secret,secretHash:o.secretHash,id:Number(o.id),from:r,to:n,trade:{qty:new A(o.qty),price:new A(o.price),side:o.side,symbol:o.symbol},timeStamp:new Date(o.timeStamp),counterParty:{status:o.counterParty.status,transactions:pr(o.counterParty.transactions),requisites:y(h({},o.counterParty.requisites),{rewardForRedeem:new A(o.counterParty.requisites.rewardForRedeem)}),trades:lr(o.counterParty.trades)},user:{status:o.user.status,transactions:pr(o.user.transactions),requisites:y(h({},o.user.requisites),{rewardForRedeem:new A(o.user.requisites.rewardForRedeem)}),trades:lr(o.user.trades)}}},lr=o=>o.map(t=>({orderId:t.orderId,price:new A(t.price),qty:new A(t.qty)})),xr=(o,e)=>o.map(t=>Ve(t,e)),br=(o,e)=>{let t=e.getSymbol(o.symbol);if(!t)throw new Error(`"${o.symbol}" symbol not found`);let[r,n]=g.convertSymbolToFromToCurrenciesPair(t,o.side,o.qty,o.price);return{id:o.id,clientOrderId:o.clientOrderId,side:o.side,status:o.status,leaveQty:new A(o.leaveQty),swapIds:o.swaps,symbol:o.symbol,type:o.type,timeStamp:new Date(o.timeStamp),from:r,to:n}};var oe=class{constructor(e){a(this,"atomexNetwork");a(this,"events",{swapUpdated:new u,orderUpdated:new u,orderBookSnapshot:new u,orderBookUpdated:new u,topOfBookUpdated:new u});a(this,"authorizationManager");a(this,"currenciesProvider");a(this,"exchangeSymbolsProvider");a(this,"apiBaseUrl");a(this,"httpClient");a(this,"_isStarted",!1);this.atomexNetwork=e.atomexNetwork,this.authorizationManager=e.authorizationManager,this.currenciesProvider=e.currenciesProvider,this.exchangeSymbolsProvider=e.exchangeSymbolsProvider,this.apiBaseUrl=e.apiBaseUrl,this.httpClient=new v(this.apiBaseUrl)}get isStarted(){return this._isStarted}async start(){this.isStarted||(this._isStarted=!0)}stop(){!this.isStarted||(this._isStarted=!1)}async getOrder(e,t){let r=`/v1/Orders/${t}`,n=this.getRequiredAuthToken(e),i=await this.httpClient.request({urlPath:r,authToken:n});return i?zt(i,this.exchangeSymbolsProvider):void 0}async getOrders(e,t){let r="/v1/Orders",n=this.getRequiredAuthToken(e),i=y(h({},t),{sortAsc:void 0,sort:(t==null?void 0:t.sortAsc)!==void 0?t.sortAsc?"Asc":"Desc":void 0}),s=await this.httpClient.request({urlPath:r,authToken:n,params:i});return s?fr(s,this.exchangeSymbolsProvider):[]}async getSymbols(){let e="/v1/Symbols",t=await this.httpClient.request({urlPath:e});return t?hr(t,this.currenciesProvider):[]}async getTopOfBook(e){let t="/v1/MarketData/quotes",r;if(e!=null&&e.length)if(typeof e[0]=="string")r=e;else{let s=this.exchangeSymbolsProvider.getSymbolsMap();r=e.map(c=>g.findExchangeSymbolAndSide(s,c.from,c.to)[0].name)}let n={symbols:r==null?void 0:r.join(",")},i=await this.httpClient.request({urlPath:t,params:n});return i?pt(i):[]}async getOrderBook(e){let t="/v1/MarketData/book",r;if(typeof e=="string")r=e;else{let s=this.exchangeSymbolsProvider.getSymbolsMap();r=g.findExchangeSymbolAndSide(s,e.from,e.to)[0].name}let n={symbol:r},i=await this.httpClient.request({urlPath:t,params:n});return i?lt(i):void 0}async addOrder(e,t){let r="/v1/Orders",n=this.getRequiredAuthToken(e),i,s,c,m;if(ur(t.orderBody)){let b=this.exchangeSymbolsProvider.getSymbolsMap(),k=g.findExchangeSymbolAndSide(b,t.orderBody.from.currencyId,t.orderBody.to.currencyId),w=k[0];i=w.name,s=k[1];let B=w.quoteCurrency===t.orderBody.from.currencyId?"from":"to";c=t.orderBody[B].amount,m=t.orderBody[B].price}else[i,s]=[t.orderBody.symbol,t.orderBody.side],c=t.orderBody.amount,m=t.orderBody.price;let d={clientOrderId:t.clientOrderId,symbol:i,side:s,type:t.orderBody.type,requisites:t.requisites?{secretHash:t.requisites.secretHash,receivingAddress:t.requisites.receivingAddress,refundAddress:t.requisites.refundAddress,rewardForRedeem:t.requisites.rewardForRedeem.toNumber(),lockTime:t.requisites.lockTime,baseCurrencyContract:t.requisites.baseCurrencyContract,quoteCurrencyContract:t.requisites.quoteCurrencyContract}:void 0,proofsOfFunds:t.proofsOfFunds,qty:c.toNumber(),price:m.toNumber()},l=await this.httpClient.request({urlPath:r,authToken:n,method:"POST",payload:d});if(l===void 0)throw new Error("Unexpected response dto");return l.orderId}async cancelOrder(e,t){let r=`/v1/Orders/${t.orderId}`,n=this.getRequiredAuthToken(e),i,s;if(t.symbol&&t.side)[i,s]=[t.symbol,t.side];else if(t.from&&t.to){let d=this.exchangeSymbolsProvider.getSymbolsMap(),l=g.findExchangeSymbolAndSide(d,t.from,t.to);i=l[0].name,s=l[1]}else throw new Error("Invalid cancelOrderRequest argument passed");let c={symbol:i,side:s},m=await this.httpClient.request({urlPath:r,authToken:n,params:c,method:"DELETE"});if(m===void 0)throw new Error("Unexpected response dto");return m}async cancelAllOrders(e,t){let r="/v1/Orders",n=this.getRequiredAuthToken(e),i,s;if(t.symbol&&t.side)[i,s]=[t.symbol,t.side];else if(t.from&&t.to){let m=this.exchangeSymbolsProvider.getSymbolsMap(),d=g.findExchangeSymbolAndSide(m,t.from,t.to);i=d[0].name,s=d[1],t.cancelAllDirections&&(s="All")}else throw new Error("Invalid cancelAllOrdersRequest argument passed");let c=await this.httpClient.request({urlPath:r,authToken:n,params:{symbol:i,side:s,forAllConnections:t.forAllConnections},method:"DELETE"});if(c===void 0)throw new Error("Unexpected response dto");return c}getSwapTransactions(e){throw new Error("Method not implemented.")}async getSwap(e,t){let r=`/v1/Swaps/${e}`,i={userIds:this.getUserIds(t).join(",")},s=await this.httpClient.request({urlPath:r,params:i});return s?Ve(s,this.exchangeSymbolsProvider):void 0}async getSwaps(e,t){let r="/v1/Swaps",n=this.getUserIds(e),i=y(h({},t),{sortAsc:void 0,sort:(t==null?void 0:t.sortAsc)!==void 0?t.sortAsc?"Asc":"Desc":void 0,userIds:n.join(",")}),s=await this.httpClient.request({urlPath:r,params:i});return s?xr(s,this.exchangeSymbolsProvider):[]}getUserIds(e){let r=(Array.isArray(e)?e:[e]).map(n=>{var i;return(i=this.authorizationManager.getAuthToken(n))==null?void 0:i.userId}).filter(n=>n);if(!r.length)throw new Error("Incorrect accountAddresses");return r}getRequiredAuthToken(e){var r;let t=(r=this.authorizationManager.getAuthToken(e))==null?void 0:r.value;if(!t)throw new Error(`Cannot find auth token for address: ${e}`);return t}};var ne=class{constructor(e,t){this.url=e;this.authToken=t;a(this,"events",{messageReceived:new u,closed:new u});a(this,"_socket");a(this,"onMessageReceived",e=>{this.events.messageReceived.emit(JSON.parse(e.data))});a(this,"onClosed",e=>{this.events.closed.emit(this,e)})}get socket(){if(!this._socket)throw new Error("Internal websocket is not created. Use the connect method first");return this._socket}async connect(){return this.disconnect(),new Promise(e=>{let t=this.authToken?["access_token",this.authToken]:void 0;this._socket=new WebSocket(this.url,t),this.socket.addEventListener("message",this.onMessageReceived),this.socket.addEventListener("error",this.onError),this.socket.addEventListener("close",this.onClosed),this.socket.addEventListener("open",()=>e())})}disconnect(){this._socket&&(this.socket.removeEventListener("message",this.onMessageReceived),this.socket.removeEventListener("error",this.onError),this.socket.removeEventListener("close",this.onClosed),this.socket.close())}subscribe(e){let t={method:"subscribe",data:e,requestId:Date.now()};this.socket.send(JSON.stringify(t))}unsubscribe(e){let t={method:"unsubscribe",data:e,requestId:Date.now()};this.socket.send(JSON.stringify(t))}onError(e){throw new Error(`Websocket received error: ${JSON.stringify(e)}`)}};var Rt=class{constructor(e,t){this.webSocketApiBaseUrl=e;this.authorizationManager=t;a(this,"events",{messageReceived:new u});a(this,"sockets",new Map);a(this,"_isStarted",!1);a(this,"onAuthorized",async e=>{this.removeSocket(e.userId);let t=new ne(new URL(Rt.EXCHANGE_URL_PATH,this.webSocketApiBaseUrl),e.value);t.events.messageReceived.addListener(this.onSocketMessageReceived),t.events.closed.addListener(this.onClosed),this.sockets.set(e.userId,t),await t.connect()});a(this,"onUnauthorized",e=>{this.removeSocket(e.userId)});a(this,"onSocketMessageReceived",e=>{this.events.messageReceived.emit(e)});a(this,"onClosed",(e,t)=>{setTimeout(()=>{e.connect()},1e3)})}get isStarted(){return this._isStarted}async start(){this.isStarted||(this.subscribeOnAuthEvents(),this._isStarted=!0)}stop(){!this.isStarted||(this.sockets.forEach((e,t)=>{this.removeSocket(t)}),this._isStarted=!1)}subscribeOnAuthEvents(){this.authorizationManager.events.authorized.addListener(this.onAuthorized),this.authorizationManager.events.unauthorized.addListener(this.onUnauthorized)}removeSocket(e){let t=this.sockets.get(e);t&&(t.events.messageReceived.removeListener(this.onSocketMessageReceived),t.events.closed.removeListener(this.onClosed),this.sockets.delete(e),t.disconnect())}},Se=Rt;a(Se,"EXCHANGE_URL_PATH","/ws/exchange");var qe=class{constructor(e){this.webSocketApiBaseUrl=e;a(this,"events",{messageReceived:new u});a(this,"socket");a(this,"_isStarted",!1);a(this,"onSocketClosed",(e,t)=>{setTimeout(async()=>{await e.connect(),this.subscribeOnStreams(e)},1e3)});a(this,"onSocketMessageReceived",e=>{this.events.messageReceived.emit(e)});this.socket=new ne(new URL(qe.MARKET_DATA_URL_PATH,this.webSocketApiBaseUrl))}get isStarted(){return this._isStarted}async start(){this.isStarted||(this.socket.events.messageReceived.addListener(this.onSocketMessageReceived),this.socket.events.closed.addListener(this.onSocketClosed),await this.socket.connect(),this.subscribeOnStreams(this.socket),this._isStarted=!0)}stop(){!this.isStarted||(this.socket.events.messageReceived.removeListener(this.onSocketMessageReceived),this.socket.events.closed.removeListener(this.onSocketClosed),this.socket.disconnect(),this._isStarted=!1)}subscribeOnStreams(e){e.subscribe(qe.TOP_OF_BOOK_STREAM),e.subscribe(qe.ORDER_BOOK_STREAM)}},q=qe;a(q,"MARKET_DATA_URL_PATH","/ws/marketdata"),a(q,"TOP_OF_BOOK_STREAM","topOfBook"),a(q,"ORDER_BOOK_STREAM","orderBook");var ie=class{constructor(e){a(this,"atomexNetwork");a(this,"events",{swapUpdated:new u,orderUpdated:new u,orderBookSnapshot:new u,orderBookUpdated:new _e,topOfBookUpdated:new u});a(this,"authorizationManager");a(this,"exchangeSymbolsProvider");a(this,"currenciesProvider");a(this,"webSocketApiBaseUrl");a(this,"marketDataWebSocketClient");a(this,"exchangeWebSocketClient");a(this,"orderBookProvider");a(this,"_isStarted",!1);a(this,"onSocketMessageReceived",e=>{switch(e.event){case"order":this.events.orderUpdated.emit(br(e.data,this.exchangeSymbolsProvider));break;case"swap":this.events.swapUpdated.emit(Ve(e.data,this.exchangeSymbolsProvider));break;case"topOfBook":this.events.topOfBookUpdated.emit(pt(e.data));break;case"snapshot":this.onOrderBookSnapshotReceived(e.data);break;case"entries":this.onOrderBookEntriesReceived(e.data);break}});this.atomexNetwork=e.atomexNetwork,this.authorizationManager=e.authorizationManager,this.currenciesProvider=e.currenciesProvider,this.exchangeSymbolsProvider=e.exchangeSymbolsProvider,this.orderBookProvider=e.orderBookProvider,this.webSocketApiBaseUrl=e.webSocketApiBaseUrl,this.exchangeWebSocketClient=new Se(this.webSocketApiBaseUrl,this.authorizationManager),this.marketDataWebSocketClient=new q(this.webSocketApiBaseUrl)}get isStarted(){return this._isStarted}async start(){this.isStarted||(this.exchangeWebSocketClient.events.messageReceived.addListener(this.onSocketMessageReceived),this.marketDataWebSocketClient.events.messageReceived.addListener(this.onSocketMessageReceived),await Promise.all([this.exchangeWebSocketClient.start(),this.marketDataWebSocketClient.start()]),this._isStarted=!0)}stop(){!this.isStarted||(this.exchangeWebSocketClient.events.messageReceived.removeListener(this.onSocketMessageReceived),this.marketDataWebSocketClient.events.messageReceived.removeListener(this.onSocketMessageReceived),this.exchangeWebSocketClient.stop(),this.marketDataWebSocketClient.stop(),this._isStarted=!1)}getOrder(e,t){throw new Error("Method not implemented.")}getOrders(e,t){throw new Error("Method not implemented.")}getSymbols(){throw new Error("Method not implemented.")}getTopOfBook(e){throw new Error("Method not implemented.")}async getOrderBook(e){throw new Error("Method not implemented.")}addOrder(e,t){throw new Error("Method not implemented.")}cancelOrder(e,t){throw new Error("Method not implemented.")}cancelAllOrders(e,t){throw new Error("Method not implemented.")}getSwapTransactions(e){throw new Error("Method not implemented.")}getSwap(e,t){throw new Error("Method not implemented.")}getSwaps(e,t){throw new Error("Method not implemented.")}onOrderBookSnapshotReceived(e){let t=lt(e);this.orderBookProvider.setOrderBook(t.symbol,t),this.events.orderBookSnapshot.emit(t)}onOrderBookEntriesReceived(e){let t=gr(e,this.orderBookProvider);for(let r of t)this.orderBookProvider.setOrderBook(r.symbol,r),this.events.orderBookUpdated.emit(r.symbol,r)}};var Te=class{constructor(e,t,r){this.atomexNetwork=e;this.restAtomexClient=t;this.webSocketAtomexClient=r;a(this,"events");a(this,"_isStarted",!1);C.ensureNetworksAreSame(this,t),C.ensureNetworksAreSame(this,r),this.events={swapUpdated:this.webSocketAtomexClient.events.swapUpdated,orderBookSnapshot:this.webSocketAtomexClient.events.orderBookSnapshot,orderBookUpdated:this.webSocketAtomexClient.events.orderBookUpdated,orderUpdated:this.webSocketAtomexClient.events.orderUpdated,topOfBookUpdated:this.webSocketAtomexClient.events.topOfBookUpdated}}get isStarted(){return this._isStarted}async start(){this.isStarted||(await Promise.all([this.webSocketAtomexClient.start(),this.restAtomexClient.start()]),this._isStarted=!0)}stop(){!this.isStarted||(this.webSocketAtomexClient.stop(),this.restAtomexClient.stop(),this._isStarted=!1)}getOrder(e,t){return this.restAtomexClient.getOrder(e,t)}getOrders(e,t){return this.restAtomexClient.getOrders(e,t)}getSymbols(){return this.restAtomexClient.getSymbols()}getTopOfBook(e){return this.restAtomexClient.getTopOfBook(e)}async getOrderBook(e){return this.restAtomexClient.getOrderBook(e)}addOrder(e,t){return this.restAtomexClient.addOrder(e,t)}cancelOrder(e,t){return this.restAtomexClient.cancelOrder(e,t)}cancelAllOrders(e,t){return this.restAtomexClient.cancelAllOrders(e,t)}getSwapTransactions(e){return this.restAtomexClient.getSwapTransactions(e)}getSwap(e,t){return this.restAtomexClient.getSwap(e,t)}getSwaps(e,t){return this.restAtomexClient.getSwaps(e,t)}};var It=(o,e)=>new Te(o.atomexNetwork,new oe({atomexNetwork:o.atomexNetwork,authorizationManager:o.managers.authorizationManager,currenciesProvider:o.providers.currenciesProvider,exchangeSymbolsProvider:o.providers.exchangeSymbolsProvider,apiBaseUrl:e.apiBaseUrl}),new ie({atomexNetwork:o.atomexNetwork,authorizationManager:o.managers.authorizationManager,currenciesProvider:o.providers.currenciesProvider,exchangeSymbolsProvider:o.providers.exchangeSymbolsProvider,orderBookProvider:o.providers.orderBookProvider,webSocketApiBaseUrl:e.webSocketApiBaseUrl}));var Le=(r=>(r[r.Local=1]="Local",r[r.Remote=2]="Remote",r[r.All=3]="All",r))(Le||{});var $e=class{constructor(e){a(this,"events",{authorized:new u,unauthorized:new u,authTokenExpiring:new u,authTokenExpired:new u});a(this,"atomexNetwork");a(this,"walletsManager");a(this,"store");a(this,"authorizationUrl");a(this,"expiringNotificationTimeInSeconds");a(this,"_authTokenData",new Map);a(this,"_isStarted",!1);a(this,"authTokenExpiringTimeoutCallback",e=>{let t=this._authTokenData.get(e.address);if(!t)return;clearTimeout(t.watcherId);let r=e.expired.getTime()-Date.now(),n=setTimeout(this.authTokenExpiredTimeoutCallback,St(r),e);this._authTokenData.set(e.address,y(h({},t),{watcherId:n})),this.events.authTokenExpiring.emit(e)});a(this,"authTokenExpiredTimeoutCallback",e=>{this.unregisterAuthToken(e),this.events.authTokenExpired.emit(e)});this.atomexNetwork=e.atomexNetwork,this.store=e.store,this.walletsManager=e.walletsManager,C.ensureNetworksAreSame(this,this.walletsManager),this.authorizationUrl=new URL($e.DEFAULT_GET_AUTH_TOKEN_URI,e.authorizationBaseUrl),this.expiringNotificationTimeInSeconds=e.expiringNotificationTimeInSeconds||$e.DEFAULT_EXPIRING_NOTIFICATION_TIME_IN_SECONDS}get isStarted(){return this._isStarted}async start(){this.isStarted||(this._isStarted=!0)}stop(){if(!!this.isStarted){for(let e of this.authTokenData)this.untrackAuthToken(e[1].watcherId);this._isStarted=!1}}get authTokenData(){return this._authTokenData}getAuthToken(e){var t;return(t=this.authTokenData.get(e))==null?void 0:t.authToken}async authorize({address:e,authTokenSource:t=3,blockchain:r,authMessage:n=$e.DEFAULT_AUTH_MESSAGE}){if((t&1)===1){let l=this.getAuthToken(e)||await this.loadAuthTokenFromStore(e);if(l&&!this.isTokenExpiring(l))return l}if((t&2)!==2)return;let i=await this.walletsManager.getWallet(e,r);if(!i)throw new Error(`Not found: the corresponding wallet by the ${e} address`);let s=this.getAuthorizationTimeStamp(n),c=await i.sign(n+s);if(c.address!==e)throw new Error("Invalid address in the signed data");let m=await this.requestAuthToken({message:n,publicKey:c.publicKeyBytes,algorithm:c.algorithm,signingDataType:c.signingDataType,signature:c.signatureBytes,timeStamp:s}),d={value:m.token,userId:m.id,address:e,expired:new Date(m.expires)};return await this.registerAuthToken(d,!0),d}async unauthorize(e){let t=this.getAuthToken(e);return t?this.unregisterAuthToken(t):!1}async loadAuthTokenFromStore(e){let t=await this.store.getAuthToken(e);if(!!t)return await this.registerAuthToken(t,!1)}async registerAuthToken(e,t){let r=this.trackAuthToken(e);if(!r)return;let n={authToken:e,watcherId:r};return this._authTokenData.set(e.address,n),t&&(e=await this.store.upsertAuthToken(e.address,e)),this.events.authorized.emit(e),e}async unregisterAuthToken(e){let t=this._authTokenData.get(e.address);if(!t)return!1;this.untrackAuthToken(t.watcherId);let r=await this.store.removeAuthToken(e)&&this._authTokenData.delete(e.address);return r&&this.events.unauthorized.emit(e),r}trackAuthToken(e){let t=e.expired.getTime()-Date.now();if(t<=0){this.store.removeAuthToken(e),this.events.authTokenExpired.emit(e);return}let r=t-this.expiringNotificationTimeInSeconds*1e3;return setTimeout(this.authTokenExpiringTimeoutCallback,St(r),e)}untrackAuthToken(e){clearTimeout(e)}getAuthorizationTimeStamp(e){return Date.now()}async requestAuthToken(e){let t=await fetch(this.authorizationUrl.href,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(await t.text());return t.json()}isTokenExpiring(e){return e.expired.getTime()-Date.now()<=this.expiringNotificationTimeInSeconds*1e3}},_=$e;a(_,"DEFAULT_AUTH_MESSAGE","Signing in "),a(_,"DEFAULT_GET_AUTH_TOKEN_URI","/v1/token"),a(_,"DEFAULT_EXPIRING_NOTIFICATION_TIME_IN_SECONDS",60);var ae=class{mapAuthTokenToSerializedAuthToken(e){return{a:e.address,u:e.userId,e:e.expired.getTime(),v:e.value}}mapSerializedAuthTokenToAuthToken(e){return{address:e.a,userId:e.u,expired:new Date(e.e),value:e.v}}};var _t=class{constructor(e,t,r=_t.DefaultKeyPrefix){this.localStorage=e;this.serializedAuthTokenMapper=t;this.keyPrefix=r}getAuthToken(e){let t=localStorage.getItem(this.getKey(e));return t&&this.serializedAuthTokenMapper.mapSerializedAuthTokenToAuthToken(JSON.parse(t))||void 0}getAuthTokens(e){return e.map(t=>this.getAuthToken(t)).filter(Boolean)}upsertAuthToken(e,t){let r=this.serializedAuthTokenMapper.mapAuthTokenToSerializedAuthToken(t);if(!r)throw new Error(`The authToken of the ${e} address can't be stored: serialization is failed`);return localStorage.setItem(this.getKey(e),JSON.stringify(r)),t}removeAuthToken(e){return localStorage.removeItem(this.getKey(e)),!0}getKey(e){return this.keyPrefix+e}},Ke=_t;a(Ke,"DefaultKeyPrefix","authToken:");var Nt=class{constructor(e,t,r=Nt.DefaultKeyPrefix){this.localStorage=e;this.serializedAuthTokenMapper=t;this.keyPrefix=r}get key(){return this.keyPrefix}getAuthToken(e){let t=this.getSerializedAuthTokensStoreObject();return t[e]&&(this.serializedAuthTokenMapper.mapSerializedAuthTokenToAuthToken(t[e])||void 0)}getAuthTokens(e){let t=this.getSerializedAuthTokensStoreObject();return Object.values(t).map(r=>this.serializedAuthTokenMapper.mapSerializedAuthTokenToAuthToken(r)).filter(r=>!!r&&e.indexOf(r.address)>-1)}upsertAuthToken(e,t){let r=this.getSerializedAuthTokensStoreObject(),n=this.serializedAuthTokenMapper.mapAuthTokenToSerializedAuthToken(t);if(!n)throw new Error(`The authToken of the ${e} address can't be stored: serialization is failed`);return r[e]=n,this.localStorage.setItem(this.key,JSON.stringify(r)),t}removeAuthToken(e){let t=this.getSerializedAuthTokensStoreObject();return t[e]?(delete t[e],Object.keys(t).length?this.localStorage.setItem(this.key,JSON.stringify(t)):this.localStorage.removeItem(this.key),!0):!1}getSerializedAuthTokensStoreObject(){let e=this.localStorage.getItem(this.key);return e?JSON.parse(e):{}}},Qe=Nt;a(Qe,"DefaultKeyPrefix","authTokens");var se=class{constructor(e="single-key",t=new ae){a(this,"storeStrategy");this.storeStrategy=typeof e=="string"?this.createPreDefinedStoreStrategy(e,t):e}getAuthToken(e){return Promise.resolve(this.storeStrategy.getAuthToken(e))}getAuthTokens(...e){return Promise.resolve(this.storeStrategy.getAuthTokens(e))}upsertAuthToken(e,t){return Promise.resolve(this.storeStrategy.upsertAuthToken(e,t))}removeAuthToken(e){let t=typeof e=="string"?e:e.address;return Promise.resolve(this.storeStrategy.removeAuthToken(t))}createPreDefinedStoreStrategy(e,t){switch(e){case"single-key":return new Qe(globalThis.localStorage,t);case"multiple-keys":return new Ke(globalThis.localStorage,t);default:throw new Error(`Unknown the store strategy name: ${e}`)}}};var Ae=class{constructor(){a(this,"authTokensMap",new Map)}getAuthToken(e){return Promise.resolve(this.authTokensMap.get(e))}getAuthTokens(...e){return Promise.resolve(e.reduce((t,r)=>{let n=this.authTokensMap.get(r);return n&&t.push(n),t},[]))}upsertAuthToken(e,t){return this.authTokensMap.set(e,t),Promise.resolve(t)}removeAuthToken(e){let t=typeof e=="string"?e:e.address;return Promise.resolve(this.authTokensMap.delete(t))}};var Dt=(o,e,t)=>{let r=globalThis.window?"browser":"node";return new _({atomexNetwork:o.atomexNetwork,walletsManager:o.managers.walletsManager,authorizationBaseUrl:e.authorizationBaseUrl,store:r==="browser"?new se(e.store.browser.storeStrategy):new Ae})};var Pr="https://api.atomex.me",zo={authorization:{authorizationBaseUrl:Pr,store:{node:{},browser:{storeStrategy:"single-key"}}},exchange:{apiBaseUrl:Pr,webSocketApiBaseUrl:"wss://api.atomex.me"}},kr="https://api.test.atomex.me",Ro={authorization:{authorizationBaseUrl:kr,store:{node:{},browser:{storeStrategy:"single-key"}}},exchange:{apiBaseUrl:kr,webSocketApiBaseUrl:"wss://ws.api.test.atomex.me"}},Wt={mainnet:zo,testnet:Ro};var ce=class{constructor(e,t=new pe(e.atomexNetwork)){this.options=e;this.atomexContext=t;a(this,"customAuthorizationManagerFactory");a(this,"customWalletsManagerFactory");a(this,"customExchangeManagerFactory")}get controlledAtomexContext(){return this.atomexContext}useAuthorizationManager(e){return this.customAuthorizationManagerFactory=e,this}useWalletsManager(e){return this.customWalletsManagerFactory=e,this}useExchangeManager(e){return this.customExchangeManagerFactory=e,this}build(){let e=new Ee;this.controlledAtomexContext.providers.blockchainProvider=e,this.controlledAtomexContext.providers.currenciesProvider=e,this.controlledAtomexContext.providers.exchangeSymbolsProvider=this.createExchangeSymbolsProvider(),this.controlledAtomexContext.providers.orderBookProvider=this.createOrderBookProvider(),this.controlledAtomexContext.managers.walletsManager=this.createWalletsManager(),this.controlledAtomexContext.managers.authorizationManager=this.createAuthorizationManager();let t=this.createDefaultExchangeService();this.controlledAtomexContext.services.exchangeService=t,this.controlledAtomexContext.services.swapService=t,this.controlledAtomexContext.managers.exchangeManager=this.createExchangeManager(),this.controlledAtomexContext.managers.swapManager=this.createSwapManager(),this.controlledAtomexContext.managers.priceManager=this.createPriceManager();let r=this.createDefaultBlockchainOptions();return new de({atomexContext:this.atomexContext,managers:{walletsManager:this.atomexContext.managers.walletsManager,authorizationManager:this.atomexContext.managers.authorizationManager,exchangeManager:this.atomexContext.managers.exchangeManager,swapManager:this.atomexContext.managers.swapManager},blockchains:r})}createExchangeSymbolsProvider(){return new j}createOrderBookProvider(){return new be}createAuthorizationManager(){let e=Wt[this.atomexContext.atomexNetwork].authorization;return this.customAuthorizationManagerFactory?this.customAuthorizationManagerFactory(this.atomexContext,e,this.options):Dt(this.atomexContext,e,this.options)}createWalletsManager(){return this.customWalletsManagerFactory?this.customWalletsManagerFactory(this.atomexContext,this.options):new ue(this.atomexContext.atomexNetwork)}createDefaultExchangeService(){let e=Wt[this.atomexContext.atomexNetwork].exchange;return It(this.atomexContext,e)}createExchangeManager(){return this.customExchangeManagerFactory?this.customExchangeManagerFactory(this.atomexContext,this.options):new xe({exchangeService:this.atomexContext.services.exchangeService,symbolsProvider:this.atomexContext.providers.exchangeSymbolsProvider,orderBookProvider:this.atomexContext.providers.orderBookProvider})}createSwapManager(){return new nt(this.atomexContext.services.swapService)}createDefaultBlockchainOptions(){return{tezos:dt(this.atomexContext),ethereum:ot(this.atomexContext)}}createPriceManager(){return new Z(new Map([["binance",new I],["kraken",new F],["atomex",new X(this.atomexContext.services.exchangeService)]]))}};var wr=o=>new ce(y(h({},o),{atomexNetwork:"mainnet"})).build(),Sr=o=>new ce(y(h({},o),{atomexNetwork:"testnet"})).build();var Ft={};D(Ft,{Atomex:()=>He,EthereumHelpers:()=>je,FA12Helpers:()=>Xe,FA2Helpers:()=>Je,Helpers:()=>me,TezosHelpers:()=>N,dt2ts:()=>L,now:()=>Ge});var p={api:{mainnet:{baseUrl:"https://api.atomex.me"},testnet:{baseUrl:"https://api.test.atomex.me"},localhost:{baseUrl:"http://127.0.0.1:5000"}},blockchains:{ethereum:{rpc:{mainnet:{chainID:1,rpc:"https://mainnet.infura.io/v3/7cd728d2d3384719a630d836f1693c5c",blockTime:10},testnet:{chainID:5,rpc:"https://goerli.infura.io/v3/7cd728d2d3384719a630d836f1693c5c",blockTime:10}}},tezos:{rpc:{mainnet:{chainID:"NetXdQprcVkpaWU",rpc:"https://rpc.tzkt.io/mainnet/",blockTime:30,minimalFees:100,minimalNanotezPerGasUnit:.1,minimalNanotezPerByte:1,costPerByte:250},testnet:{chainID:"NetXnHfVqm9iesp",rpc:"https://rpc.tzkt.io/ithacanet/",blockTime:15,minimalFees:100,minimalNanotezPerGasUnit:.1,minimalNanotezPerByte:1,costPerByte:250}}}},currencies:{ETH:{contracts:{mainnet:{address:"0xe9c251cbb4881f9e056e40135e7d3ea9a7d037df",initiateGasLimitWithoutReward:2e5,initiateGasLimitWithReward:21e4,redeemGasLimit:14e4},testnet:{address:"0x512fe6B803bA327DCeFBF2Cec7De333f761B0f2b",initiateGasLimitWithoutReward:2e5,initiateGasLimitWithReward:21e4,redeemGasLimit:14e4},abi:[{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"_hashedSecret",type:"bytes32"}],name:"Activated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"_hashedSecret",type:"bytes32"},{indexed:!1,internalType:"address",name:"_sender",type:"address"},{indexed:!1,internalType:"uint256",name:"_value",type:"uint256"}],name:"Added",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"_hashedSecret",type:"bytes32"},{indexed:!0,internalType:"address",name:"_participant",type:"address"},{indexed:!1,internalType:"address",name:"_initiator",type:"address"},{indexed:!1,internalType:"uint256",name:"_refundTimestamp",type:"uint256"},{indexed:!1,internalType:"uint256",name:"_countdown",type:"uint256"},{indexed:!1,internalType:"uint256",name:"_value",type:"uint256"},{indexed:!1,internalType:"uint256",name:"_payoff",type:"uint256"},{indexed:!1,internalType:"bool",name:"_active",type:"bool"}],name:"Initiated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"_hashedSecret",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"_secret",type:"bytes32"}],name:"Redeemed",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"_hashedSecret",type:"bytes32"}],name:"Refunded",type:"event"},{constant:!0,inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"swaps",outputs:[{internalType:"bytes32",name:"hashedSecret",type:"bytes32"},{internalType:"address payable",name:"initiator",type:"address"},{internalType:"address payable",name:"participant",type:"address"},{internalType:"uint256",name:"refundTimestamp",type:"uint256"},{internalType:"uint256",name:"countdown",type:"uint256"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"payoff",type:"uint256"},{internalType:"bool",name:"active",type:"bool"},{internalType:"enum Atomex.State",name:"state",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_hashedSecret",type:"bytes32"},{internalType:"address payable",name:"_participant",type:"address"},{internalType:"uint256",name:"_refundTimestamp",type:"uint256"},{internalType:"uint256",name:"_payoff",type:"uint256"}],name:"initiate",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_hashedSecret",type:"bytes32"}],name:"add",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_hashedSecret",type:"bytes32"}],name:"activate",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_hashedSecret",type:"bytes32"},{internalType:"bytes32",name:"_secret",type:"bytes32"}],name:"redeem",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_hashedSecret",type:"bytes32"}],name:"refund",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"}]},decimals:{original:18,displayed:4},blockchain:"ethereum"},XTZ:{contracts:{mainnet:{address:"KT1VG2WtYdSWz5E7chTeAdDPZNy2MpP8pTfL",redeemTxSize:133,initiateTxSize:200,gasLimit:15e3},testnet:{address:"KT1SJMtHZFSPva5AzQEx5btBuQ8BjvXqort3",redeemTxSize:133,initiateTxSize:200,gasLimit:85e3},entrypoints:{default:{prim:"or",args:[{prim:"or",args:[{prim:"pair",args:[{prim:"address",annots:["%participant"]},{prim:"pair",args:[{prim:"pair",args:[{prim:"bytes",annots:["%hashed_secret"]},{prim:"timestamp",annots:["%refund_time"]}]},{prim:"mutez",annots:["%payoff"]}],annots:["%settings"]}],annots:[":initiate","%initiate"]},{prim:"bytes",annots:[":hashed_secret","%add"]}],annots:["%fund"]},{prim:"or",args:[{prim:"bytes",annots:[":secret","%redeem"]},{prim:"bytes",annots:[":hashed_secret","%refund"]}],annots:["%withdraw"]}]},withdraw:{prim:"or",args:[{prim:"bytes",annots:[":secret","%redeem"]},{prim:"bytes",annots:[":hashed_secret","%refund"]}]},refund:{prim:"bytes",annots:[":hashed_secret"]},redeem:{prim:"bytes",annots:[":secret"]},initiate:{prim:"pair",args:[{prim:"address",annots:["%participant"]},{prim:"pair",args:[{prim:"pair",args:[{prim:"bytes",annots:["%hashed_secret"]},{prim:"timestamp",annots:["%refund_time"]}]},{prim:"mutez",annots:["%payoff"]}],annots:["%settings"]}],annots:[":initiate"]},fund:{prim:"or",args:[{prim:"pair",args:[{prim:"address",annots:["%participant"]},{prim:"pair",args:[{prim:"pair",args:[{prim:"bytes",annots:["%hashed_secret"]},{prim:"timestamp",annots:["%refund_time"]}]},{prim:"mutez",annots:["%payoff"]}],annots:["%settings"]}],annots:[":initiate","%initiate"]},{prim:"bytes",annots:[":hashed_secret","%add"]}]},add:{prim:"bytes",annots:[":hashed_secret"]}}},decimals:{original:6,displayed:3},blockchain:"tezos"},TZBTC:{contracts:{mainnet:{address:"KT1Ap287P1NzsnToSJdA4aqSNjPomRaHBZSr",tokenAddress:"KT1PWx2mnDueood7fEmfbBDKx1D9BAnnXitn",redeemTxSize:133,initiateTxSize:250,gasLimit:1e5},testnet:{address:"KT1Jj1jzDQbDRHt4u7M73DUrBDV1napRbNFr",tokenAddress:"",redeemTxSize:133,initiateTxSize:250,gasLimit:1e5},entrypoints:{default:{prim:"or",args:[{prim:"or",args:[{prim:"pair",args:[{prim:"pair",args:[{prim:"pair",args:[{prim:"bytes",annots:["%hashedSecret"]},{prim:"address",annots:["%participant"]}]},{prim:"pair",args:[{prim:"nat",annots:["%payoffAmount"]},{prim:"timestamp",annots:["%refundTime"]}]}]},{prim:"pair",args:[{prim:"address",annots:["%tokenAddress"]},{prim:"nat",annots:["%totalAmount"]}]}],annots:["%initiate"]},{prim:"bytes",annots:["%redeem"]}]},{prim:"bytes",annots:["%refund"]}]},refund:{prim:"bytes"},redeem:{prim:"bytes"},initiate:{prim:"pair",args:[{prim:"pair",args:[{prim:"pair",args:[{prim:"bytes",annots:["%hashedSecret"]},{prim:"address",annots:["%participant"]}]},{prim:"nat",annots:["%payoffAmount"]},{prim:"timestamp",annots:["%refundTime"]}]},{prim:"address",annots:["%tokenAddress"]},{prim:"nat",annots:["%totalAmount"]}]}}},decimals:{original:8,displayed:4},blockchain:"tezos"},USDT_XTZ:{contracts:{mainnet:{address:"KT1Ays1Chwx3ArnHGoQXchUgDsvKe9JboUjj",tokenAddress:"KT1XnTn74bUtxHfDtBmm2bGZAQfhPbvKWR8o",redeemTxSize:2e4,initiateTxSize:2e4,gasLimit:4e5},testnet:{address:"KT1HHjNxi3okxxGJT1SPPhpcs3gMQt8hqixY",tokenAddress:"KT1BWvRQnVVowZZLGkct9A7sdj5YEe8CdUhR",redeemTxSize:2e4,initiateTxSize:2e4,gasLimit:4e5},entrypoints:{default:{prim:"or",args:[{prim:"or",args:[{prim:"pair",args:[{prim:"pair",args:[{prim:"pair",args:[{prim:"bytes",annots:["%hashedSecret"]},{prim:"address",annots:["%participant"]}]},{prim:"pair",args:[{prim:"nat",annots:["%payoffAmount"]},{prim:"timestamp",annots:["%refundTime"]}]}]},{prim:"pair",args:[{prim:"pair",args:[{prim:"address",annots:["%tokenAddress"]},{prim:"nat",annots:["%tokenId"]}]},{prim:"nat",annots:["%totalAmount"]}]}],annots:["%initiate"]},{prim:"bytes",annots:["%redeem"]}]},{prim:"bytes",annots:["%refund"]}]},refund:{prim:"bytes"},redeem:{prim:"bytes"},initiate:{prim:"pair",args:[{prim:"pair",args:[{prim:"pair",args:[{prim:"bytes",annots:["%hashedSecret"]},{prim:"address",annots:["%participant"]}]},{prim:"nat",annots:["%payoffAmount"]},{prim:"timestamp",annots:["%refundTime"]}]},{prim:"pair",args:[{prim:"address",annots:["%tokenAddress"]},{prim:"nat",annots:["%tokenId"]}]},{prim:"nat",annots:["%totalAmount"]}]}}},decimals:{original:6,displayed:4},blockchain:"tezos"}}};var He=class{constructor(e,t,r){a(this,"_network");a(this,"_baseUrl");a(this,"_authToken");a(this,"_authorizationManager");this._network=e,this._baseUrl=t,this._authToken=r}static create(e){return new He(e=="mainnet"?"mainnet":"testnet",p.api[e].baseUrl)}setAuthorizationManager(e){this._authorizationManager=e}getLocalAuthToken(e){var r;let t=(r=this._authorizationManager)==null?void 0:r.getAuthToken(e);return t==null?void 0:t.value}setAuthToken(e){this._authToken=e}async makeRequest(e,t,r=!1,n,i){let s=new URL(t,this._baseUrl);n!==void 0&&Object.keys(n).forEach(l=>s.searchParams.append(l,n[l]));let c={};if(r){let l=typeof r=="string"?this.getLocalAuthToken(r):this._authToken;if(!l)throw new Error("Auth token is undefined");c.Authorization=`Bearer ${l}`}let m;e==="post"&&i!==void 0&&(m=JSON.stringify(i),c["Content-Type"]="application/json");let d=await fetch(s.toString(),{method:e,headers:c,body:m});if(d.ok)return d.json();{let l=await d.text();throw Error(l)}}async getAuthToken(e){return this.makeRequest("post","/v1/Token",!1,{},e)}async getSymbols(){return this.makeRequest("get","/v1/Symbols",!1)}async getQuotes(e){let t=e!==void 0&&e.length>0?e.join(","):"All";return this.makeRequest("get","/v1/MarketData/quotes",!1,{symbols:t})}async getOrderBook(e){return this.makeRequest("get","/v1/MarketData/book",!1,{symbol:e})}async addOrder(e){var i;let[t,r]=this.splitSymbol(e.symbol).map(s=>this.getCurrencyConfig(s)),n=e;return n.requisites=h({baseCurrencyContract:t.contractAddress,quoteCurrencyContract:r.contractAddress},n.requisites),this.makeRequest("post","/v1/Orders",((i=e.requisites)==null?void 0:i.receivingAddress)||!0,{},n).then(s=>s.orderId)}async getOrders(e,t){return this.makeRequest("get","/v1/Orders",e||!0,h({},t))}async getOrder(e,t){return this.makeRequest("get",`/v1/Orders/${e}`,t||!0)}async cancelOrder(e,t,r,n){return this.makeRequest("delete",`/v1/Orders/${e}`,n||!0,{symbol:t,side:r}).then(i=>i.result)}async addSwapRequisites(e,t){return this.makeRequest("post",`/v1/Swaps/${e}/requisites`,(t==null?void 0:t.receivingAddress)||!0,{},t).then(r=>r.result)}async getSwaps(e,t){return this.makeRequest("get","/v1/Swaps",e||!0,h({},t))}async getSwap(e,t){return this.makeRequest("get",`/v1/Swaps/${e}`,t||!0)}getOrderPreview(e,t,r,n){let i=e.entries.filter(m=>m.side==t?!1:(()=>{switch(t+n){case"BuySend":case"SellReceive":return r/m.price;default:return r}})()<=Math.max(...m.qtyProfile)).map(m=>m.price);if(i.length==0)throw new Error(`No matching order found (${n} ${r} / ${t})`);let s=t=="Buy"?Math.min(...i):Math.max(...i),c=()=>{switch(t+n){case"BuySend":case"SellReceive":return r/s;default:return r*s}};return{price:s,amountSent:n=="Send"?r:c(),amountReceived:n=="Receive"?r:c()}}splitSymbol(e){let[t,r]=e.split("/",2);if(!t||!r)throw new Error("Symbol is invalid");return[t,r]}getCurrencyConfig(e){let t=Object.entries(p.currencies).find(([r,n])=>r==e);if(t==null)throw new Error(`No matching config section for ${e}`);return{blockchain:t[1].blockchain,decimals:t[1].decimals.original,displayDecimals:t[1].decimals.displayed,contractAddress:t[1].contracts[this._network].address,tokenAddress:t[1].contracts[this._network].tokenAddress}}formatAmount(e,t){let r=this.getCurrencyConfig(t);return parseFloat(typeof e=="string"?parseFloat(e).toFixed(r.displayDecimals):e.toFixed(r.displayDecimals))}getOrderSide(e,t,r){let[n,i]=this.splitSymbol(e);if(n===t&&i===r)return"Sell";if(i===t&&n===r)return"Buy";throw new Error(`Mismatch ${t} => ${r} (${e})`)}getMaxOrderSize(e,t){return Math.max(...e.entries.filter(r=>r.side!=t).map(r=>Math.max(...r.qtyProfile)))}};import ut from"bignumber.js";import Io from"elliptic";import _o from"web3";var me=class{constructor(e){this.atomex=e}validateInitiateTransactionBySwap(e){let t=e.counterParty.transactions.find(n=>n.type==="Lock");if(!t)return Promise.resolve({status:"NotFound",confirmations:0,nextBlockETA:0});let r=this.atomex.getCurrency(e.to.currencyId);if(!r)throw new Error(`Config of the "${e.to.currencyId}" not found`);return this.validateInitiateTransaction(t.blockId,t.id,e.secretHash,e.user.requisites.receivingAddress,x.tokensAmountToNat(e.to.amount,r.decimals),x.tokensAmountToNat(e.user.requisites.rewardForRedeem,r.decimals),0,2)}},L=o=>Math.round(new Date(o).getTime()/1e3),Ge=()=>Math.round(Date.now()/1e3);var je=class extends me{constructor(t,r,n,i,s,c,m,d){super(t);a(this,"_web3");a(this,"_contract");a(this,"_timeBetweenBlocks");a(this,"_functions");a(this,"_initiateGasLimitWithoutReward");a(this,"_initiateGasLimitWithReward");a(this,"_redeemGasLimit");this._web3=r,this._contract=this.createContract(n,i),this._timeBetweenBlocks=s,this._initiateGasLimitWithoutReward=c,this._initiateGasLimitWithReward=m,this._redeemGasLimit=d,this._functions=new Map,this.initializeFunctions(n)}initializeFunctions(t){t.forEach(r=>{r.type==="function"&&this._functions.set(r.name,{types:r.inputs,signature:this._web3.eth.abi.encodeFunctionSignature(r)})})}static async create(t,r,n){let i=p.blockchains.ethereum.rpc[r];n!==void 0&&(i.rpc=n);let s=new _o(i.rpc),c=await s.eth.getChainId();if(i.chainID!==c)throw new Error(`Wrong chain ID: expected ${i.chainID}, actual ${c}`);return new je(t,s,p.currencies.ETH.contracts.abi,p.currencies.ETH.contracts[r].address,i.blockTime,p.currencies.ETH.contracts[r].initiateGasLimitWithoutReward,p.currencies.ETH.contracts[r].initiateGasLimitWithReward,p.currencies.ETH.contracts[r].redeemGasLimit)}getAuthMessage(t,r){let n=Date.now();return{message:t,timestamp:n,msgToSign:t+n.toString(),algorithm:"Keccak256WithEcdsa:Geth2940"}}buildInitiateTransaction(t){if(t.refundTimestamp<Ge())throw new Error(`Swap timestamp is in the past: ${t.refundTimestamp}`);return{data:this._contract.methods.initiate("0x"+t.secretHash,t.receivingAddress,t.refundTimestamp,t.rewardForRedeem.toString(10)).encodeABI(),contractAddr:this._contract.options.address,amount:t.netAmount.plus(t.rewardForRedeem)}}buildRedeemTransaction(t,r){return{data:this._contract.methods.redeem(r,t).encodeABI(),contractAddr:this._contract.options.address}}buildRefundTransaction(t){return{data:this._contract.methods.refund(t).encodeABI(),contractAddr:this._contract.options.address}}buildActivateTransaction(t){return{data:this._contract.methods.activate(t).encodeABI(),contractAddr:this._contract.options.address}}parseInitiateParameters(t){let r=this._functions.get("initiate");if(!t.input.startsWith(r.signature))throw new Error(`Unexpected method signature: ${t.input}`);let n=this._web3.eth.abi.decodeParameters(r.types,t.input.slice(r.signature.length));return{secretHash:n._hashedSecret.slice(2),receivingAddress:n._participant,refundTimestamp:parseInt(n._refundTimestamp),rewardForRedeem:new ut(this._web3.utils.toBN(n._payoff).toString()),netAmount:new ut(this._web3.utils.toBN(t.value).sub(this._web3.utils.toBN(n._payoff)).toString())}}async validateInitiateTransaction(t,r,n,i,s,c,m,d=2){var $;s=new ut(s),c=new ut(c);let l=s.minus(c),b=await this.getTransaction(r);try{if(!b)throw new Error(`Failed to retrieve transaction: ${r}`);let f=[];(($=b.to)==null?void 0:$.toLowerCase())!==this._contract.options.address.toLowerCase()&&f.push(`Wrong contract address: expect ${this._contract.options.address}, actual ${b.to}`);let O=this.parseInitiateParameters(b);if(O.secretHash!==n&&f.push(`Secret hash: expect ${n}, actual ${O.secretHash}`),O.receivingAddress.toLowerCase()!==i.toLowerCase()&&f.push(`Receiving address: expect ${i}, actual ${O.receivingAddress}`),O.netAmount.isEqualTo(l)||f.push(`Net amount: expect ${l.toString(10)}, actual ${O.netAmount.toString(10)}`),O.refundTimestamp<m&&f.push(`Refund timestamp: minimum ${m}, actual ${O.refundTimestamp}`),f.length){let M=f.reduce((S,yt,gt)=>`${S}
	${gt+1}. ${yt};`,`Initiate transaction that satisfies the expected criteria is not found in ${r} contents:`);throw new Error(M)}}catch(f){return{status:"Invalid",message:f.message,confirmations:0,nextBlockETA:0}}let k=await this.getBlock("latest"),w=k.number-(b.blockNumber||k.number),B={status:b.blockNumber!==void 0?"Included":"Pending",confirmations:w,nextBlockETA:parseInt(k.timestamp.toString())+this._timeBetweenBlocks};return w>=d&&(B.status="Confirmed"),B}hexSlice(t,r,n){return"0x"+n.slice(t*2+2,r*2+2)}getVRS(t){let r=[this.hexSlice(64,(t.length-2)/2,t),this.hexSlice(0,32,t),this.hexSlice(32,64,t)];return{v:parseInt(r[0].slice(2),16),r:r[1].slice(2),s:r[2].slice(2)}}recoverPublicKey(t,r){let n=this._web3.eth.accounts.hashMessage(t),i=this.getVRS(r),c=new Io.ec("secp256k1").recoverPubKey(Buffer.from(n.slice(2),"hex"),i,i.v<2?i.v:1-i.v%2);return"0x"+c.encode("hex",!1)}encodePublicKey(t){return t.startsWith("0x")?t.slice(2):t}encodeSignature(t){let r=this.getVRS(t);return r.r.padStart(64,"0")+r.s.padStart(64,"0")}async estimateInitiateFees(t){let r=await this._web3.eth.getGasPrice();return parseInt(r)*this._initiateGasLimitWithReward*1.2}async estimateRedeemFees(t){let r=await this._web3.eth.getGasPrice(),n=parseInt(r)*this._redeemGasLimit;return{totalCost:n,rewardForRedeem:2*n}}isValidAddress(t){return this._web3.utils.isAddress(t)}getTransaction(t){return this._web3.eth.getTransaction(t)}getBlock(t){return this._web3.eth.getBlock(t)}createContract(t,r){return new this._web3.eth.Contract(t,r)}};import{ParameterSchema as No}from"@taquito/michelson-encoder";import{OpKind as Do}from"@taquito/rpc";import{TezosToolkit as Wo}from"@taquito/taquito";import{b58cdecode as ht,prefix as Ze,validateAddress as Fo,ValidationResult as Uo}from"@taquito/utils";import ve from"bignumber.js";var Vo=o=>new Date(o*1e3).toISOString().slice(0,-5)+"Z",N=class extends me{constructor(t,r,n,i,s,c,m,d,l,b,k,w){super(t);a(this,"_tezos");a(this,"_contractAddress");a(this,"_timeBetweenBlocks");a(this,"_entrypoints");a(this,"_gasLimit");a(this,"_minimalFees");a(this,"_minimalNanotezPerGasUnit");a(this,"_minimalNanotezPerByte");a(this,"_costPerByte");a(this,"_redeemTxSize");a(this,"_initiateTxSize");this._tezos=r,this._contractAddress=i,this._timeBetweenBlocks=s,this._gasLimit=c,this._minimalFees=m,this._minimalNanotezPerGasUnit=d,this._minimalNanotezPerByte=l,this._costPerByte=b,this._redeemTxSize=k,this._initiateTxSize=w,this._entrypoints=new Map(Object.entries(n).map(([B,$])=>[B,new No($)]))}static async create(t,r,n="XTZ",i){let s=p.blockchains.tezos.rpc[r];i!==void 0&&(s.rpc=i);let c=new Wo(s.rpc),m=await c.rpc.getChainId();if(s.chainID!==m.toString())throw new Error(`Wrong chain ID: expected ${s.chainID}, actual ${m}`);return new N(t,c,p.currencies[n].contracts.entrypoints,p.currencies[n].contracts[r].address,p.blockchains.tezos.rpc[r].blockTime,p.currencies[n].contracts[r].gasLimit,p.blockchains.tezos.rpc[r].minimalFees,p.blockchains.tezos.rpc[r].minimalNanotezPerGasUnit,p.blockchains.tezos.rpc[r].minimalNanotezPerByte,p.blockchains.tezos.rpc[r].costPerByte,p.currencies[n].contracts[r].redeemTxSize,p.currencies[n].contracts[r].initiateTxSize)}getTezosAlgorithm(t){switch(t){case"tz1":return"Ed25519:Blake2b";case"tz2":return"Blake2bWithEcdsa:Secp256k1";case"tz3":return"Blake2bWithEcdsa:Secp256r1";default:throw new Error(`Unexpected address prefix: ${t}`)}}getAuthMessage(t,r){let n=Date.now();return{message:t,timestamp:n,msgToSign:t+n.toString(),algorithm:this.getTezosAlgorithm(r.slice(0,3))}}buildInitiateTransaction(t){var n;if(t.refundTimestamp<Ge())throw new Error(`Swap timestamp is in the past: ${t.refundTimestamp}`);let r=(n=this._entrypoints.get("initiate"))==null?void 0:n.Encode(t.receivingAddress,t.secretHash,Vo(t.refundTimestamp),t.rewardForRedeem);return{data:{entrypoint:"initiate",value:r},contractAddr:this._contractAddress,amount:t.netAmount.plus(t.rewardForRedeem)}}buildRedeemTransaction(t,r=""){var n;return{data:{entrypoint:"redeem",value:(n=this._entrypoints.get("redeem"))==null?void 0:n.Encode(t)},contractAddr:this._contractAddress}}buildRefundTransaction(t){var r;return{data:{entrypoint:"refund",value:(r=this._entrypoints.get("refund"))==null?void 0:r.Encode(t)},contractAddr:this._contractAddress}}getBlockDetails(t){return{level:t.metadata.level_info.level,timestamp:L(t.header.timestamp)}}parseInitiateParameters(t){var i;if(t.parameters===void 0)throw new Error("Parameters are undefined");let r=(i=this._entrypoints.get(t.parameters.entrypoint))==null?void 0:i.Execute(t.parameters.value);if(r===void 0)throw new Error(`Unexpected entrypoint: ${t.parameters.entrypoint}`);let n=(()=>{switch(t.parameters.entrypoint){case"initiate":return r;case"fund":case"default":return r.initiate;default:throw new Error(`Unexpected entrypoint: ${t.parameters.entrypoint}`)}})();return{secretHash:n.settings.hashed_secret,receivingAddress:n.participant,refundTimestamp:L(n.settings.refund_time),netAmount:new ve(t.amount).minus(n.settings.payoff),rewardForRedeem:new ve(n.settings.payoff)}}findContractCall(t,r){var s;let n=(s=t.operations[3])==null?void 0:s.find(c=>c.hash==r);if(n===void 0)throw new Error(`Operation not found: ${r} @ ${t.hash}`);let i=n.contents.filter(c=>c.kind=="transaction"&&c.destination==this._contractAddress);if(i.length===0)throw new Error("Unsupported contract version is used");return i}async validateInitiateTransaction(t,r,n,i,s,c,m,d=2){s=new ve(s),c=new ve(c);let l=s.minus(c),b=await this.getBlock(t);try{let f=[];if(!this.findContractCall(b,r).find(M=>{f=[];let S=this.parseInitiateParameters(M);return S.secretHash!==n&&f.push(`Secret hash: expect ${n}, actual ${S.secretHash}. Counter = ${M.counter}`),S.receivingAddress.toLowerCase()!==i.toLowerCase()&&f.push(`Receiving address: expect ${i}, actual ${S.receivingAddress}. Counter = ${M.counter}`),S.netAmount.isEqualTo(l)||f.push(`Net amount: expect ${l.toString(10)}, actual ${S.netAmount.toString(10)}. Counter = ${M.counter}`),S.refundTimestamp<m&&f.push(`Refund timestamp: minimum ${m}, actual ${S.refundTimestamp}. Counter = ${M.counter}`),!f.length},this)){let M=f.reduce((S,yt,gt)=>`${S}
	${gt+1}. ${yt};`,`Initiate transaction that satisfies the expected criteria is not found in ${r} contents:`);throw new Error(M)}}catch(f){return{status:"Invalid",message:f.message,confirmations:0,nextBlockETA:0}}let k=this.getBlockDetails(await this.getBlock("head")),w=this.getBlockDetails(b),B=k.level-w.level,$={status:"Included",confirmations:B,nextBlockETA:k.timestamp+this._timeBetweenBlocks};return B>=d&&($.status="Confirmed"),$}encodePublicKey(t){switch(t.substring(0,2)){case"ed":return Buffer.from(ht(t,Ze.edpk)).toString("hex");case"p2":return Buffer.from(ht(t,Ze.p2pk)).toString("hex");case"sp":return Buffer.from(ht(t,Ze.sppk)).toString("hex");default:throw new Error("Unsupported Public Key Type")}}encodeSignature(t){var n;let r=t.startsWith("sig")?t.substring(0,3):t.substring(0,5);if(Object.prototype.hasOwnProperty.call(Ze,r))return Buffer.from(ht(t,(n=Object.getOwnPropertyDescriptor(Ze,r))==null?void 0:n.value)).toString("hex");throw new Error("Unsupported Signature Type")}calcFees(t=0,r=0,n=0){return this._minimalFees+this._minimalNanotezPerGasUnit*t+this._minimalNanotezPerByte*n+r*this._costPerByte}async estimateInitiateFees(t){let r={receivingAddress:"tz1Q2prWCrDGFDuGTe7axdt4z9e3QkCqdhmD",secretHash:"169cbd29345af89a0983f28254e71bdd1367890b9876fc8a9ea117c32f6a521b",refundTimestamp:2147483647,rewardForRedeem:new ve(0),netAmount:new ve(100)},n=this.buildInitiateTransaction(r),i=await this._tezos.rpc.getBlockHeader(),s=await this._tezos.rpc.getContract(t),c=await this._tezos.rpc.runOperation({chain_id:i.chain_id,operation:{branch:i.hash,signature:"sigUHx32f9wesZ1n2BWpixXz4AQaZggEtchaQNHYGRCoWNAXx45WGW2ua3apUUUAGMLPwAU41QoaFCzVSL61VaessLg4YbbP",contents:[{amount:"0",counter:(parseInt(s.counter||"0")+1).toString(),destination:this._contractAddress,fee:this.calcFees(104e4,6e4,this._initiateTxSize).toString(),gas_limit:"1040000",kind:Do.TRANSACTION,source:t,storage_limit:"60000",parameters:n.data}]}}),m=0,d=0;return c.contents.forEach(l=>{if(l.metadata.operation_result.status!=="applied")throw new Error("Some error was encountered while estimating fees");d+=parseInt(l.metadata.operation_result.consumed_gas||"0"),m+=parseInt(l.metadata.operation_result.paid_storage_size_diff||"0")}),this.calcFees(d,m,this._initiateTxSize)}async estimateRedeemFees(t){let r=this.calcFees(this._gasLimit,0,this._redeemTxSize);return await this._tezos.rpc.getManagerKey(t)===null&&(r+=257*this._costPerByte),{totalCost:r,rewardForRedeem:2*r}}isValidAddress(t){return Fo(t)==Uo.VALID}getBlock(t){return this._tezos.rpc.getBlock({block:t.toString()})}};import{TezosToolkit as qo}from"@taquito/taquito";import Tr from"bignumber.js";var Xe=class extends N{static async create(e,t,r,n){let i=p.blockchains.tezos.rpc[t];n!==void 0&&(i.rpc=n);let s=new qo(i.rpc),c=await s.rpc.getChainId();if(i.chainID!==c.toString())throw new Error(`Wrong chain ID: expected ${i.chainID}, actual ${c}`);return new Xe(e,s,p.currencies[r].contracts.entrypoints,p.currencies[r].contracts[t].address,p.blockchains.tezos.rpc[t].blockTime,p.currencies[r].contracts[t].gasLimit,p.blockchains.tezos.rpc[t].minimalFees,p.blockchains.tezos.rpc[t].minimalNanotezPerGasUnit,p.blockchains.tezos.rpc[t].minimalNanotezPerByte,p.blockchains.tezos.rpc[t].costPerByte,p.currencies[r].contracts[t].redeemTxSize,p.currencies[r].contracts[t].initiateTxSize)}parseInitiateParameters(e){var n;if(e.parameters===void 0)throw new Error("Parameters are undefined");let t=(n=this._entrypoints.get(e.parameters.entrypoint))==null?void 0:n.Execute(e.parameters.value);if(t===void 0)throw new Error(`Unexpected entrypoint: ${e.parameters.entrypoint}`);let r=(()=>{switch(e.parameters.entrypoint){case"initiate":return t;case"default":return t.initiate;default:throw new Error(`Unexpected entrypoint: ${e.parameters.entrypoint}`)}})();return{secretHash:r.hashedSecret,receivingAddress:r.participant,refundTimestamp:L(r.refundTime),netAmount:new Tr(r.totalAmount).minus(r.payoffAmount),rewardForRedeem:new Tr(r.payoffAmount)}}};import{TezosToolkit as Lo}from"@taquito/taquito";import Ar from"bignumber.js";var Je=class extends N{static async create(e,t,r,n){let i=p.blockchains.tezos.rpc[t];n!==void 0&&(i.rpc=n);let s=new Lo(i.rpc),c=await s.rpc.getChainId();if(i.chainID!==c.toString())throw new Error(`Wrong chain ID: expected ${i.chainID}, actual ${c}`);return new Je(e,s,p.currencies[r].contracts.entrypoints,p.currencies[r].contracts[t].address,p.blockchains.tezos.rpc[t].blockTime,p.currencies[r].contracts[t].gasLimit,p.blockchains.tezos.rpc[t].minimalFees,p.blockchains.tezos.rpc[t].minimalNanotezPerGasUnit,p.blockchains.tezos.rpc[t].minimalNanotezPerByte,p.blockchains.tezos.rpc[t].costPerByte,p.currencies[r].contracts[t].redeemTxSize,p.currencies[r].contracts[t].initiateTxSize)}parseInitiateParameters(e){var n;if(!e.parameters)throw new Error("Parameters are undefined");let t=(n=this._entrypoints.get(e.parameters.entrypoint))==null?void 0:n.Execute(e.parameters.value);if(!t)throw new Error(`Unexpected entrypoint: ${e.parameters.entrypoint}`);let r=this.getInitiateParams(e.parameters.entrypoint,t);return{secretHash:r.hashedSecret,receivingAddress:r.participant,refundTimestamp:L(r.refundTime),netAmount:new Ar(r.totalAmount).minus(r.payoffAmount),rewardForRedeem:new Ar(r.payoffAmount)}}getInitiateParams(e,t){switch(e){case"initiate":return t;case"default":return t.initiate;default:throw new Error(`Unexpected entrypoint: ${e}`)}}};export{de as Atomex,ce as AtomexBuilder,Le as AuthTokenSource,_ as AuthorizationManager,Re as DataSource,ae as DefaultSerializedAuthTokenMapper,G as ERC20EthereumWeb3AtomexProtocolV1,H as EthereumWeb3AtomexProtocolV1,xe as ExchangeManager,ee as FA12TezosTaquitoAtomexProtocolV1,te as FA2TezosTaquitoAtomexProtocolV1,Ie as ImportantDataReceivingMode,Ae as InMemoryAuthorizationManagerStore,j as InMemoryExchangeSymbolsProvider,se as LocalStorageAuthorizationManagerStore,Te as MixedApiAtomexClient,oe as RestAtomexClient,J as TaquitoBlockchainWallet,Y as TezosTaquitoAtomexProtocolV1,ue as WalletsManager,he as Web3BlockchainWallet,ie as WebSocketAtomexClient,C as atomexUtils,x as converters,wr as createDefaultMainnetAtomex,Sr as createDefaultTestnetAtomex,le as guards,Ft as legacy,St as prepareTimeoutDuration,Ce as textUtils,hn as wait};
//# sourceMappingURL=index.js.map
